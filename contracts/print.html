<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book-be1d94da.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-b1a6ec98.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-7b70ea14.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/EspressoSystems/espresso-network" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <!-- This file serves as the landing page for the published smart contract docs.
     Links point to .sol files for GitHub. During doc generation (just doc-contracts),
     they are transformed to point to the generated documentation. -->
<h1 id="espresso-network-smart-contracts"><a class="header" href="#espresso-network-smart-contracts">Espresso Network Smart Contracts</a></h1>
<p>Smart contracts for the Espresso Network.</p>
<p>Upgradeable contracts use the frozen inheritance pattern: each new version (e.g. <code>StakeTableV2</code>) inherits from the
previous version, preserving storage layout and ensuring upgrade safety.</p>
<h3 id="contracts"><a class="header" href="#contracts">Contracts</a></h3>
<ul>
<li><a href="#esptoken">EspToken</a></li>
<li><a href="#esptokenv2">EspTokenV2</a></li>
<li><a href="#feecontract">FeeContract</a></li>
<li><a href="#initializedat">InitializedAt</a></li>
<li><a href="#lightclient">LightClient</a></li>
<li><a href="#lightclientarbitrum">LightClientArbitrum</a></li>
<li><a href="#lightclientarbitrumv2">LightClientArbitrumV2</a></li>
<li><a href="#lightclientarbitrumv3">LightClientArbitrumV3</a></li>
<li><a href="#lightclientv2">LightClientV2</a></li>
<li><a href="#lightclientv3">LightClientV3</a></li>
<li><a href="#opstimelock">OpsTimelock</a></li>
<li><a href="#rewardclaim-1">RewardClaim</a></li>
<li><a href="#safeexittimelock">SafeExitTimelock</a></li>
<li><a href="#staketable">StakeTable</a></li>
<li><a href="#staketablev2">StakeTableV2</a></li>
</ul>
<h3 id="interfaces"><a class="header" href="#interfaces">Interfaces</a></h3>
<ul>
<li><a href="#ilightclient">ILightClient</a></li>
<li><a href="#iplonkverifier">IPlonkVerifier</a></li>
<li><a href="#irewardclaim">IRewardClaim</a></li>
</ul>
<h3 id="libraries"><a class="header" href="#libraries">Libraries</a></h3>
<ul>
<li><a href="#blssig">BLSSig</a></li>
<li><a href="src/libraries/EdOnBn254.sol/library.EdOnBn254.html">EdOnBN254</a></li>
<li><a href="#plonkverifier">PlonkVerifier</a></li>
<li><a href="#rewardmerkletreeverifier">RewardMerkleTreeVerifier</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="contents"><a class="header" href="#contents">Contents</a></h1>
<ul>
<li><a href="/contracts/src/interfaces">interfaces</a></li>
<li><a href="/contracts/src/legacy">legacy</a></li>
<li><a href="/contracts/src/libraries">libraries</a></li>
<li><a href="#esptoken">EspToken</a></li>
<li><a href="#esptokenv2">EspTokenV2</a></li>
<li><a href="#feecontract">FeeContract</a></li>
<li><a href="#initializedat">InitializedAt</a></li>
<li><a href="#lightclient">LightClient</a></li>
<li><a href="#arbsys">ArbSys</a></li>
<li><a href="#lightclientarbitrum">LightClientArbitrum</a></li>
<li><a href="#arbsys-1">ArbSys</a></li>
<li><a href="#lightclientarbitrumv2">LightClientArbitrumV2</a></li>
<li><a href="#arbsys-2">ArbSys</a></li>
<li><a href="#lightclientarbitrumv3">LightClientArbitrumV3</a></li>
<li><a href="#lightclientv2">LightClientV2</a></li>
<li><a href="#lightclientv3">LightClientV3</a></li>
<li><a href="#opstimelock">OpsTimelock</a></li>
<li><a href="#rewardclaim-1">RewardClaim</a></li>
<li><a href="#safeexittimelock">SafeExitTimelock</a></li>
<li><a href="#staketable">StakeTable</a></li>
<li><a href="#staketablev2">StakeTableV2</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="contents-1"><a class="header" href="#contents-1">Contents</a></h1>
<ul>
<li><a href="#ilightclient">ILightClient</a></li>
<li><a href="#iplonkverifier">IPlonkVerifier</a></li>
<li><a href="#irewardclaim">IRewardClaim</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="ilightclient"><a class="header" href="#ilightclient">ILightClient</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/interfaces/ILightClient.sol">Git Source</a></p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="blocksperepoch"><a class="header" href="#blocksperepoch">blocksPerEpoch</a></h3>
<pre><code class="language-solidity">function blocksPerEpoch() external view returns (uint64);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="iplonkverifier"><a class="header" href="#iplonkverifier">IPlonkVerifier</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/interfaces/IPlonkVerifier.sol">Git Source</a></p>
<p><strong>Title:</strong>
The structs and interfaces for a specific flavor of TurboPlonk verifier.</p>
<h2 id="functions-1"><a class="header" href="#functions-1">Functions</a></h2>
<h3 id="verify"><a class="header" href="#verify">verify</a></h3>
<p>Verify a single TurboPlonk proofs.</p>
<pre><code class="language-solidity">function verify(
    VerifyingKey memory verifyingKey,
    uint256[] memory publicInput,
    PlonkProof memory proof
) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>verifyingKey</code></td><td><code>VerifyingKey</code></td><td>The Plonk verification key</td></tr>
<tr><td><code>publicInput</code></td><td><code>uint256[]</code></td><td>The public input fields</td></tr>
<tr><td><code>proof</code></td><td><code>PlonkProof</code></td><td>The TurboPlonk proof</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>_ A boolean indicating successful verification, false otherwise</td></tr>
</tbody>
</table>
</div>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="plonkproof"><a class="header" href="#plonkproof">PlonkProof</a></h3>
<pre><code class="language-solidity">struct PlonkProof {
    // the first 5 are 4 inputs and 1 output wire poly commmitments
    // i.e., batch_proof.wires_poly_comms_vec.iter()
    // wire0 is 32 bytes which is a pointer to BN254.G1Point
    BN254.G1Point wire0; // 0x00
    BN254.G1Point wire1; // 0x20
    BN254.G1Point wire2; // 0x40
    BN254.G1Point wire3; // 0x60
    BN254.G1Point wire4; // 0x80
    // the next one is the  product permutation poly commitment
    // i.e., batch_proof.prod_perm_poly_comms_vec.iter()
    BN254.G1Point prodPerm; // 0xA0
    // the next 5 are split quotient poly commmitments
    // i.e., batch_proof.split_quot_poly_comms
    BN254.G1Point split0; // 0xC0
    BN254.G1Point split1; // 0xE0
    BN254.G1Point split2; // 0x100
    BN254.G1Point split3; // 0x120
    BN254.G1Point split4; // 0x140
    // witness poly com for aggregated opening at `zeta`
    // i.e., batch_proof.opening_proof
    BN254.G1Point zeta; // 0x160
    // witness poly com for shifted opening at `zeta * \omega`
    // i.e., batch_proof.shifted_opening_proof
    BN254.G1Point zetaOmega; // 0x180
    // wire poly eval at `zeta`
    BN254.ScalarField wireEval0; // 0x1A0
    BN254.ScalarField wireEval1; // 0x1C0
    BN254.ScalarField wireEval2; // 0x1E0
    BN254.ScalarField wireEval3; // 0x200
    BN254.ScalarField wireEval4; // 0x220
    // extended permutation (sigma) poly eval at `zeta`
    // last (sigmaEval4) is saved by Maller Optimization
    BN254.ScalarField sigmaEval0; // 0x240
    BN254.ScalarField sigmaEval1; // 0x260
    BN254.ScalarField sigmaEval2; // 0x280
    BN254.ScalarField sigmaEval3; // 0x2A0
    // product permutation poly eval at `zeta * \omega`
    BN254.ScalarField prodPermZetaOmegaEval; // 0x2C0
}
</code></pre>
<h3 id="verifyingkey"><a class="header" href="#verifyingkey">VerifyingKey</a></h3>
<pre><code class="language-solidity">struct VerifyingKey {
    uint256 domainSize; // 0x00
    uint256 numInputs; // 0x20
    // commitment to extended perm (sigma) poly
    BN254.G1Point sigma0; // 0x40
    BN254.G1Point sigma1; // 0x60
    BN254.G1Point sigma2; // 0x80
    BN254.G1Point sigma3; // 0xA0
    BN254.G1Point sigma4; // 0xC0
    // commitment to selector poly
    // first 4 are linear combination selector
    BN254.G1Point q1; // 0xE0
    BN254.G1Point q2; // 0x100
    BN254.G1Point q3; // 0x120
    BN254.G1Point q4; // 0x140
    // multiplication selector for 1st, 2nd wire
    BN254.G1Point qM12; // 0x160
    // multiplication selector for 3rd, 4th wire
    BN254.G1Point qM34; // 0x180
    // output selector
    BN254.G1Point qO; // 0x1A0
    // constant term selector
    BN254.G1Point qC; // 0x1C0
    // rescue selector qH1 * w_ai^5
    BN254.G1Point qH1; // 0x1E0
    // rescue selector qH2 * w_bi^5
    BN254.G1Point qH2; // 0x200
    // rescue selector qH3 * w_ci^5
    BN254.G1Point qH3; // 0x220
    // rescue selector qH4 * w_di^5
    BN254.G1Point qH4; // 0x240
    // elliptic curve selector
    BN254.G1Point qEcc; // 0x260
    // serialized G2 point in SRS (compressed, little-endian, 64 bytes)
    // we store the 64 bytes as 2 * bytes32 (first 32 bytes as `g2LSB`)
    // (G1 points in SRS are implicitly committed via poly commitments)
    bytes32 g2LSB; // 0x280
    bytes32 g2MSB; // 0x2A0
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="irewardclaim"><a class="header" href="#irewardclaim">IRewardClaim</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/interfaces/IRewardClaim.sol">Git Source</a></p>
<p>This interface contains the methods, events and errors for claiming Espresso staking
rewards.</p>
<p>This interface does not include administrative functionality of the RewardClaim
contract.</p>
<h2 id="functions-2"><a class="header" href="#functions-2">Functions</a></h2>
<h3 id="claimrewards"><a class="header" href="#claimrewards">claimRewards</a></h3>
<p>Claim staking rewards</p>
<p>Obtain authData from the Espresso query service API.</p>
<pre><code class="language-solidity">function claimRewards(uint256 lifetimeRewards, bytes calldata authData) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>lifetimeRewards</code></td><td><code>uint256</code></td><td>Total earned lifetime rewards for the user @param</td></tr>
<tr><td><code>authData</code></td><td><code>bytes</code></td><td>inputs required for authentication of lifetime rewards amount.</td></tr>
</tbody>
</table>
</div>
<h3 id="claimedrewards"><a class="header" href="#claimedrewards">claimedRewards</a></h3>
<p>Check amount of rewards claimed by a user</p>
<pre><code class="language-solidity">function claimedRewards(address claimer) external view returns (uint256);
</code></pre>
<h3 id="totalclaimed"><a class="header" href="#totalclaimed">totalClaimed</a></h3>
<p>Total amount claimed by all users</p>
<pre><code class="language-solidity">function totalClaimed() external view returns (uint256);
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="rewardsclaimed"><a class="header" href="#rewardsclaimed">RewardsClaimed</a></h3>
<p>User claimed rewards</p>
<pre><code class="language-solidity">event RewardsClaimed(address indexed user, uint256 amount);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="invalidauthroot"><a class="header" href="#invalidauthroot">InvalidAuthRoot</a></h3>
<p>Unable to authenticate rewards against Light Client contract</p>
<pre><code class="language-solidity">error InvalidAuthRoot();
</code></pre>
<h3 id="alreadyclaimed"><a class="header" href="#alreadyclaimed">AlreadyClaimed</a></h3>
<p>All available rewards already claimed</p>
<pre><code class="language-solidity">error AlreadyClaimed();
</code></pre>
<h3 id="invalidrewardamount"><a class="header" href="#invalidrewardamount">InvalidRewardAmount</a></h3>
<p>Reward amount must be greater than zero</p>
<pre><code class="language-solidity">error InvalidRewardAmount();
</code></pre>
<h3 id="dailylimitexceeded"><a class="header" href="#dailylimitexceeded">DailyLimitExceeded</a></h3>
<p>A claim would exceed the remaining daily capacity</p>
<pre><code class="language-solidity">error DailyLimitExceeded();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="contents-2"><a class="header" href="#contents-2">Contents</a></h1>
<ul>
<li><a href="#transcript">Transcript</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="transcript"><a class="header" href="#transcript">Transcript</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/legacy/Transcript.sol">Git Source</a></p>
<h2 id="functions-3"><a class="header" href="#functions-3">Functions</a></h2>
<h3 id="appendmessage"><a class="header" href="#appendmessage">appendMessage</a></h3>
<pre><code class="language-solidity">function appendMessage(TranscriptData memory self, bytes memory message) internal pure;
</code></pre>
<h3 id="appendchallenge"><a class="header" href="#appendchallenge">appendChallenge</a></h3>
<pre><code class="language-solidity">function appendChallenge(TranscriptData memory self, uint256 challenge) internal pure;
</code></pre>
<h3 id="appendcommitments"><a class="header" href="#appendcommitments">appendCommitments</a></h3>
<pre><code class="language-solidity">function appendCommitments(TranscriptData memory self, BN254.G1Point[] memory comms)
    internal
    pure;
</code></pre>
<h3 id="appendcommitment"><a class="header" href="#appendcommitment">appendCommitment</a></h3>
<pre><code class="language-solidity">function appendCommitment(TranscriptData memory self, BN254.G1Point memory comm) internal pure;
</code></pre>
<h3 id="getchallenge"><a class="header" href="#getchallenge">getChallenge</a></h3>
<pre><code class="language-solidity">function getChallenge(TranscriptData memory self) internal pure returns (uint256 ret);
</code></pre>
<h3 id="appendvkandpubinput"><a class="header" href="#appendvkandpubinput">appendVkAndPubInput</a></h3>
<p>Append the verifying key and the public inputs to the transcript.</p>
<pre><code class="language-solidity">function appendVkAndPubInput(
    TranscriptData memory self,
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    uint256[] memory publicInput
) internal pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>self</code></td><td><code>TranscriptData</code></td><td></td></tr>
<tr><td><code>verifyingKey</code></td><td><code>IPlonkVerifier.VerifyingKey</code></td><td>verifying key</td></tr>
<tr><td><code>publicInput</code></td><td><code>uint256[]</code></td><td>a list of field elements</td></tr>
</tbody>
</table>
</div>
<h3 id="appendproofevaluations"><a class="header" href="#appendproofevaluations">appendProofEvaluations</a></h3>
<p>Append the proof to the transcript. Only used for test purposes.</p>
<pre><code class="language-solidity">function appendProofEvaluations(
    TranscriptData memory self,
    IPlonkVerifier.PlonkProof memory proof
) internal pure;
</code></pre>
<h2 id="structs-1"><a class="header" href="#structs-1">Structs</a></h2>
<h3 id="transcriptdata"><a class="header" href="#transcriptdata">TranscriptData</a></h3>
<pre><code class="language-solidity">struct TranscriptData {
    bytes32 state;
    bytes transcript;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="contents-3"><a class="header" href="#contents-3">Contents</a></h1>
<ul>
<li><a href="#blssig">BLSSig</a></li>
<li><a href="#erc1967proxy">ERC1967Proxy</a></li>
<li><a href="#edonbn254">EdOnBN254</a></li>
<li><a href="#lightclientstateupdatevk">LightClientStateUpdateVK</a></li>
<li><a href="#lightclientstateupdatevkv2">LightClientStateUpdateVKV2</a></li>
<li><a href="#lightclientstateupdatevkv3">LightClientStateUpdateVKV3</a></li>
<li><a href="#plonkverifier">PlonkVerifier</a></li>
<li><a href="#plonkverifierv2">PlonkVerifierV2</a></li>
<li><a href="#plonkverifierv3">PlonkVerifierV3</a></li>
<li><a href="#polynomialeval">PolynomialEval</a></li>
<li><a href="#polynomialevalv2">PolynomialEvalV2</a></li>
<li><a href="#polynomialevalv3">PolynomialEvalV3</a></li>
<li><a href="#rewardmerkletreeverifier">RewardMerkleTreeVerifier</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="blssig"><a class="header" href="#blssig">BLSSig</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/BLSSig.sol">Git Source</a></p>
<p>test top
This library implements the verification of the BLS signature scheme over the BN254 curve
following
the rust implementation at
https://github.com/EspressoSystems/jellyfish/blob/e1e683c287f20160738e6e737295dd8f9e70577a/primitives/src/signatures/bls_over_bn254.rs</p>
<h2 id="functions-4"><a class="header" href="#functions-4">Functions</a></h2>
<h3 id="_uint256frombyteslittleendian"><a class="header" href="#_uint256frombyteslittleendian">_uint256FromBytesLittleEndian</a></h3>
<pre><code class="language-solidity">function _uint256FromBytesLittleEndian(uint8[] memory input) private pure returns (uint256);
</code></pre>
<h3 id="expand"><a class="header" href="#expand">expand</a></h3>
<p>Takes a sequence of bytes and turn in into another sequence of bytes with fixed size.
Equivalent of
https://github.com/arkworks-rs/algebra/blob/1f7b3c6b215e98fa3130b39d2967f6b43df41e04/ff/src/fields/field_hashers/expander/mod.rs#L37</p>
<pre><code class="language-solidity">function expand(bytes memory message) internal pure returns (bytes memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>message</code></td><td><code>bytes</code></td><td>message to be “expanded”</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes</code></td><td>fixed size array of bytes</td></tr>
</tbody>
</table>
</div>
<h3 id="hashtofield"><a class="header" href="#hashtofield">hashToField</a></h3>
<p>Hash a sequence of bytes to a field element in Fq. Equivalent of
https://github.com/arkworks-rs/algebra/blob/1f7b3c6b215e98fa3130b39d2967f6b43df41e04/ff/src/fields/field_hashers/mod.rs#L65</p>
<pre><code class="language-solidity">function hashToField(bytes memory message) internal pure returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>message</code></td><td><code>bytes</code></td><td>input message to be hashed</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>field element in Fq</td></tr>
</tbody>
</table>
</div>
<h3 id="hashtocurve"><a class="header" href="#hashtocurve">hashToCurve</a></h3>
<p>Hash a sequence of bytes to a group element in BN254.G_1. We use the hash-and-pray
algorithm for now.
Rust implementation can be found at
https://github.com/EspressoSystems/jellyfish/blob/e1e683c287f20160738e6e737295dd8f9e70577a/primitives/src/signatures/bls_over_bn254.rs#L318</p>
<pre><code class="language-solidity">function hashToCurve(bytes memory input) internal view returns (BN254.G1Point memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>input</code></td><td><code>bytes</code></td><td>message to be hashed</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>BN254.G1Point</code></td><td>group element in G_1</td></tr>
</tbody>
</table>
</div>
<h3 id="verifyblssig"><a class="header" href="#verifyblssig">verifyBlsSig</a></h3>
<p>Verify a bls signature. Reverts if the signature is invalid</p>
<pre><code class="language-solidity">function verifyBlsSig(bytes memory message, BN254.G1Point memory sig, BN254.G2Point memory pk)
    internal
    view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>message</code></td><td><code>bytes</code></td><td>message to check the signature against</td></tr>
<tr><td><code>sig</code></td><td><code>BN254.G1Point</code></td><td>signature represented as a point in BN254.G_1</td></tr>
<tr><td><code>pk</code></td><td><code>BN254.G2Point</code></td><td>public key represented as a point in BN254.G_2</td></tr>
</tbody>
</table>
</div>
<h2 id="errors-1"><a class="header" href="#errors-1">Errors</a></h2>
<h3 id="blssigverificationfailed"><a class="header" href="#blssigverificationfailed">BLSSigVerificationFailed</a></h3>
<pre><code class="language-solidity">error BLSSigVerificationFailed();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="erc1967proxy"><a class="header" href="#erc1967proxy">ERC1967Proxy</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/ERC1967Proxy.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Proxy</p>
<p>This contract implements an upgradeable proxy. It is upgradeable because calls are delegated
to an
implementation address that can be changed. This address is stored in storage in the location
specified by
https://eips.ethereum.org/EIPS/eip-1967[EIP1967], so that it doesn’t conflict with the storage
layout of the
implementation behind the proxy.</p>
<h2 id="functions-5"><a class="header" href="#functions-5">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>Initializes the upgradeable proxy with an initial implementation specified by
<code>implementation</code>.
If <code>_data</code> is nonempty, it’s used as data in a delegate call to <code>implementation</code>. This will
typically be an
encoded function call, and allows initializing the storage of the proxy like a Solidity
constructor.
Requirements:</p>
<ul>
<li>If <code>data</code> is empty, <code>msg.value</code> must be zero.</li>
</ul>
<pre><code class="language-solidity">constructor(address implementation, bytes memory _data) payable;
</code></pre>
<h3 id="_implementation"><a class="header" href="#_implementation">_implementation</a></h3>
<p>Returns the current implementation address.
TIP: To get this value clients can read directly from the storage slot shown below (specified
by EIP1967) using
the https://eth.wiki/json-rpc/API#eth_getstorageat[<code>eth_getStorageAt</code>] RPC call.
<code>0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc</code></p>
<pre><code class="language-solidity">function _implementation() internal view virtual override returns (address);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="edonbn254"><a class="header" href="#edonbn254">EdOnBN254</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/EdOnBn254.sol">Git Source</a></p>
<p>Edward curve on BN254.
This library only implements a serialization function that is consistent with
Arkworks’ format. It does not support any group operations.</p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="p_mod"><a class="header" href="#p_mod">P_MOD</a></h3>
<pre><code class="language-solidity">uint256 public constant P_MOD =
    21888242871839275222246405745257275088548364400416034343698204186575808495617
</code></pre>
<h2 id="functions-6"><a class="header" href="#functions-6">Functions</a></h2>
<h3 id="isynegative"><a class="header" href="#isynegative">isYNegative</a></h3>
<p>Check if y-coordinate of G1 point is negative.</p>
<pre><code class="language-solidity">function isYNegative(EdOnBN254Point memory point) internal pure returns (bool);
</code></pre>
<h3 id="isequal"><a class="header" href="#isequal">isEqual</a></h3>
<p>Check if two points are equal</p>
<pre><code class="language-solidity">function isEqual(EdOnBN254Point memory a, EdOnBN254Point memory b)
    internal
    pure
    returns (bool);
</code></pre>
<h2 id="structs-2"><a class="header" href="#structs-2">Structs</a></h2>
<h3 id="edonbn254point"><a class="header" href="#edonbn254point">EdOnBN254Point</a></h3>
<pre><code class="language-solidity">struct EdOnBN254Point {
    uint256 x;
    uint256 y;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lightclientstateupdatevk"><a class="header" href="#lightclientstateupdatevk">LightClientStateUpdateVK</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/LightClientStateUpdateVK.sol">Git Source</a></p>
<h2 id="functions-7"><a class="header" href="#functions-7">Functions</a></h2>
<h3 id="getvk"><a class="header" href="#getvk">getVk</a></h3>
<pre><code class="language-solidity">function getVk() internal pure returns (IPlonkVerifier.VerifyingKey memory vk);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lightclientstateupdatevkv2"><a class="header" href="#lightclientstateupdatevkv2">LightClientStateUpdateVKV2</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/LightClientStateUpdateVKV2.sol">Git Source</a></p>
<h2 id="functions-8"><a class="header" href="#functions-8">Functions</a></h2>
<h3 id="getvk-1"><a class="header" href="#getvk-1">getVk</a></h3>
<pre><code class="language-solidity">function getVk() internal pure returns (IPlonkVerifier.VerifyingKey memory vk);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lightclientstateupdatevkv3"><a class="header" href="#lightclientstateupdatevkv3">LightClientStateUpdateVKV3</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/LightClientStateUpdateVKV3.sol">Git Source</a></p>
<h2 id="functions-9"><a class="header" href="#functions-9">Functions</a></h2>
<h3 id="getvk-2"><a class="header" href="#getvk-2">getVk</a></h3>
<pre><code class="language-solidity">function getVk() internal pure returns (IPlonkVerifier.VerifyingKey memory vk);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="plonkverifier"><a class="header" href="#plonkverifier">PlonkVerifier</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/PlonkVerifier.sol">Git Source</a></p>
<p>The TurboPlonk formula is:
qo * wo = pub_input + q_c +
q_mul0 * w0 * w1 + q_mul1 * w2 * w3 +
q_lc0 * w0 + q_lc1 * w1 + q_lc2 * w2 + q_lc3 * w3 +
q_hash0 * w0 + q_hash1 * w1 + q_hash2 * w2 + q_hash3 * w3 +
q_ecc * w0 * w1 * w2 * w3 * wo</p>
<h2 id="state-variables-1"><a class="header" href="#state-variables-1">State Variables</a></h2>
<h3 id="coset_k1"><a class="header" href="#coset_k1">COSET_K1</a></h3>
<pre><code class="language-solidity">uint256 internal constant COSET_K1 =
    0x2f8dd1f1a7583c42c4e12a44e110404c73ca6c94813f85835da4fb7bb1301d4a
</code></pre>
<h3 id="coset_k2"><a class="header" href="#coset_k2">COSET_K2</a></h3>
<pre><code class="language-solidity">uint256 internal constant COSET_K2 =
    0x1ee678a0470a75a6eaa8fe837060498ba828a3703b311d0f77f010424afeb025
</code></pre>
<h3 id="coset_k3"><a class="header" href="#coset_k3">COSET_K3</a></h3>
<pre><code class="language-solidity">uint256 internal constant COSET_K3 =
    0x2042a587a90c187b0a087c03e29c968b950b1db26d5c82d666905a6895790c0a
</code></pre>
<h3 id="coset_k4"><a class="header" href="#coset_k4">COSET_K4</a></h3>
<pre><code class="language-solidity">uint256 internal constant COSET_K4 =
    0x2e2b91456103698adf57b799969dea1c8f739da5d8d40dd3eb9222db7c81e881
</code></pre>
<h3 id="beta_h_x0"><a class="header" href="#beta_h_x0">BETA_H_X0</a></h3>
<pre><code class="language-solidity">uint256 internal constant BETA_H_X0 =
    0x260e01b251f6f1c7e7ff4e580791dee8ea51d87a358e038b4efe30fac09383c1
</code></pre>
<h3 id="beta_h_x1"><a class="header" href="#beta_h_x1">BETA_H_X1</a></h3>
<pre><code class="language-solidity">uint256 internal constant BETA_H_X1 =
    0x0118c4d5b837bcc2bc89b5b398b5974e9f5944073b32078b7e231fec938883b0
</code></pre>
<h3 id="beta_h_y0"><a class="header" href="#beta_h_y0">BETA_H_Y0</a></h3>
<pre><code class="language-solidity">uint256 internal constant BETA_H_Y0 =
    0x04fc6369f7110fe3d25156c1bb9a72859cf2a04641f99ba4ee413c80da6a5fe4
</code></pre>
<h3 id="beta_h_y1"><a class="header" href="#beta_h_y1">BETA_H_Y1</a></h3>
<pre><code class="language-solidity">uint256 internal constant BETA_H_Y1 =
    0x22febda3c0c0632a56475b4214e5615e11e6dd3f96e6cea2854a87d4dacc5e55
</code></pre>
<h3 id="num_wire_types"><a class="header" href="#num_wire_types">NUM_WIRE_TYPES</a></h3>
<p>The number of wire types of the circuit, TurboPlonk has 5.</p>
<pre><code class="language-solidity">uint256 internal constant NUM_WIRE_TYPES = 5
</code></pre>
<h2 id="functions-10"><a class="header" href="#functions-10">Functions</a></h2>
<h3 id="verify-1"><a class="header" href="#verify-1">verify</a></h3>
<p>Verify a single TurboPlonk proofs.</p>
<pre><code class="language-solidity">function verify(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    uint256[7] memory publicInput,
    IPlonkVerifier.PlonkProof memory proof
) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>verifyingKey</code></td><td><code>IPlonkVerifier.VerifyingKey</code></td><td>The Plonk verification key</td></tr>
<tr><td><code>publicInput</code></td><td><code>uint256[7]</code></td><td>The public input fields</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>The TurboPlonk proof</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>_ A boolean indicating successful verification, false otherwise</td></tr>
</tbody>
</table>
</div>
<h3 id="_validateproof"><a class="header" href="#_validateproof">_validateProof</a></h3>
<p>Validate all group points and scalar fields. Revert if
any are invalid.</p>
<pre><code class="language-solidity">function _validateProof(IPlonkVerifier.PlonkProof memory proof) internal pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>A Plonk proof</td></tr>
</tbody>
</table>
</div>
<h3 id="_verify"><a class="header" href="#_verify">_verify</a></h3>
<pre><code class="language-solidity">function _verify(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    uint256[7] memory publicInput,
    IPlonkVerifier.PlonkProof memory proof
) private view returns (bool);
</code></pre>
<h3 id="_computechallenges"><a class="header" href="#_computechallenges">_computeChallenges</a></h3>
<pre><code class="language-solidity">function _computeChallenges(
    IPlonkVerifier.VerifyingKey memory vk,
    uint256[7] memory pi,
    IPlonkVerifier.PlonkProof memory proof
) internal pure returns (Challenges memory res);
</code></pre>
<h3 id="_computelinpolyconstantterm"><a class="header" href="#_computelinpolyconstantterm">_computeLinPolyConstantTerm</a></h3>
<p>Compute the constant term of the linearization polynomial.</p>
<pre><code>r_plonk = PI - L1(x) * alpha^2 - alpha * \prod_i=1..m-1 (w_i + beta * sigma_i + gamma) *
(w_m + gamma) * z(xw)
</code></pre>
<p>where m is the number of wire types.</p>
<pre><code class="language-solidity">function _computeLinPolyConstantTerm(
    Challenges memory chal,
    IPlonkVerifier.PlonkProof memory proof,
    Poly.EvalData memory evalData
) internal pure returns (uint256 res);
</code></pre>
<h3 id="_preparepolycommitments"><a class="header" href="#_preparepolycommitments">_preparePolyCommitments</a></h3>
<pre><code class="language-solidity">function _preparePolyCommitments(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    Challenges memory chal,
    Poly.EvalData memory evalData,
    IPlonkVerifier.PlonkProof memory proof
) internal view returns (BN254.G1Point memory e1, BN254.G1Point memory f1);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>e1</code></td><td><code>BN254.G1Point</code></td><td>The [E]1 in Sec 8.4, step 11 of Plonk</td></tr>
<tr><td><code>f1</code></td><td><code>BN254.G1Point</code></td><td>The [F]1 in Sec 8.4, step 10 of Plonk</td></tr>
</tbody>
</table>
</div>
<h3 id="_linearizationpolycomm"><a class="header" href="#_linearizationpolycomm">_linearizationPolyComm</a></h3>
<p>Compute the linearization poly commitment</p>
<pre><code class="language-solidity">function _linearizationPolyComm(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    Challenges memory challenge,
    Poly.EvalData memory evalData,
    IPlonkVerifier.PlonkProof memory proof
) private view returns (BN254.G1Point memory d1);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>verifyingKey</code></td><td><code>IPlonkVerifier.VerifyingKey</code></td><td>The verifying key</td></tr>
<tr><td><code>challenge</code></td><td><code>Challenges</code></td><td>A set of challenges</td></tr>
<tr><td><code>evalData</code></td><td><code>Poly.EvalData</code></td><td>Polynomial evaluation data</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>A Plonk proof</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>d1</code></td><td><code>BN254.G1Point</code></td><td>The [D]1 in Step 9 of Plonk</td></tr>
</tbody>
</table>
</div>
<h2 id="errors-2"><a class="header" href="#errors-2">Errors</a></h2>
<h3 id="invalidplonkargs"><a class="header" href="#invalidplonkargs">InvalidPlonkArgs</a></h3>
<p>Plonk: invalid inputs, either mismatching lengths among input arguments
or empty input.</p>
<pre><code class="language-solidity">error InvalidPlonkArgs();
</code></pre>
<h3 id="wrongplonkvk"><a class="header" href="#wrongplonkvk">WrongPlonkVK</a></h3>
<p>Plonk: wrong verification key used.</p>
<pre><code class="language-solidity">error WrongPlonkVK();
</code></pre>
<h2 id="structs-3"><a class="header" href="#structs-3">Structs</a></h2>
<h3 id="challenges"><a class="header" href="#challenges">Challenges</a></h3>
<p>Plonk IOP verifier challenges.</p>
<pre><code class="language-solidity">struct Challenges {
    uint256 alpha; // 0x00
    uint256 alpha2; // 0x20
    uint256 alpha3; // 0x40
    uint256 beta; // 0x60
    uint256 gamma; // 0x80
    uint256 zeta; // 0xA0
    uint256 v; // 0xC0
    uint256 u; // 0xE0
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="plonkverifierv2"><a class="header" href="#plonkverifierv2">PlonkVerifierV2</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/PlonkVerifierV2.sol">Git Source</a></p>
<p>The TurboPlonk formula is:
qo * wo = pub_input + q_c +
q_mul0 * w0 * w1 + q_mul1 * w2 * w3 +
q_lc0 * w0 + q_lc1 * w1 + q_lc2 * w2 + q_lc3 * w3 +
q_hash0 * w0 + q_hash1 * w1 + q_hash2 * w2 + q_hash3 * w3 +
q_ecc * w0 * w1 * w2 * w3 * wo</p>
<h2 id="state-variables-2"><a class="header" href="#state-variables-2">State Variables</a></h2>
<h3 id="coset_k1-1"><a class="header" href="#coset_k1-1">COSET_K1</a></h3>
<pre><code class="language-solidity">uint256 public constant COSET_K1 =
    0x2f8dd1f1a7583c42c4e12a44e110404c73ca6c94813f85835da4fb7bb1301d4a
</code></pre>
<h3 id="coset_k2-1"><a class="header" href="#coset_k2-1">COSET_K2</a></h3>
<pre><code class="language-solidity">uint256 public constant COSET_K2 =
    0x1ee678a0470a75a6eaa8fe837060498ba828a3703b311d0f77f010424afeb025
</code></pre>
<h3 id="coset_k3-1"><a class="header" href="#coset_k3-1">COSET_K3</a></h3>
<pre><code class="language-solidity">uint256 public constant COSET_K3 =
    0x2042a587a90c187b0a087c03e29c968b950b1db26d5c82d666905a6895790c0a
</code></pre>
<h3 id="coset_k4-1"><a class="header" href="#coset_k4-1">COSET_K4</a></h3>
<pre><code class="language-solidity">uint256 public constant COSET_K4 =
    0x2e2b91456103698adf57b799969dea1c8f739da5d8d40dd3eb9222db7c81e881
</code></pre>
<h3 id="beta_h_x0-1"><a class="header" href="#beta_h_x0-1">BETA_H_X0</a></h3>
<pre><code class="language-solidity">uint256 public constant BETA_H_X0 =
    0x260e01b251f6f1c7e7ff4e580791dee8ea51d87a358e038b4efe30fac09383c1
</code></pre>
<h3 id="beta_h_x1-1"><a class="header" href="#beta_h_x1-1">BETA_H_X1</a></h3>
<pre><code class="language-solidity">uint256 public constant BETA_H_X1 =
    0x0118c4d5b837bcc2bc89b5b398b5974e9f5944073b32078b7e231fec938883b0
</code></pre>
<h3 id="beta_h_y0-1"><a class="header" href="#beta_h_y0-1">BETA_H_Y0</a></h3>
<pre><code class="language-solidity">uint256 public constant BETA_H_Y0 =
    0x04fc6369f7110fe3d25156c1bb9a72859cf2a04641f99ba4ee413c80da6a5fe4
</code></pre>
<h3 id="beta_h_y1-1"><a class="header" href="#beta_h_y1-1">BETA_H_Y1</a></h3>
<pre><code class="language-solidity">uint256 public constant BETA_H_Y1 =
    0x22febda3c0c0632a56475b4214e5615e11e6dd3f96e6cea2854a87d4dacc5e55
</code></pre>
<h3 id="num_wire_types-1"><a class="header" href="#num_wire_types-1">NUM_WIRE_TYPES</a></h3>
<p>The number of wire types of the circuit, TurboPlonk has 5.</p>
<pre><code class="language-solidity">uint256 internal constant NUM_WIRE_TYPES = 5
</code></pre>
<h2 id="functions-11"><a class="header" href="#functions-11">Functions</a></h2>
<h3 id="verify-2"><a class="header" href="#verify-2">verify</a></h3>
<p>Verify a single TurboPlonk proofs.</p>
<pre><code class="language-solidity">function verify(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    uint256[11] memory publicInput,
    IPlonkVerifier.PlonkProof memory proof
) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>verifyingKey</code></td><td><code>IPlonkVerifier.VerifyingKey</code></td><td>The Plonk verification key</td></tr>
<tr><td><code>publicInput</code></td><td><code>uint256[11]</code></td><td>The public input fields</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>The TurboPlonk proof</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>_ A boolean indicating successful verification, false otherwise</td></tr>
</tbody>
</table>
</div>
<h3 id="_validateproof-1"><a class="header" href="#_validateproof-1">_validateProof</a></h3>
<p>Validate all group points and scalar fields. Revert if
any are invalid.</p>
<pre><code class="language-solidity">function _validateProof(IPlonkVerifier.PlonkProof memory proof) internal pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>A Plonk proof</td></tr>
</tbody>
</table>
</div>
<h3 id="_verify-1"><a class="header" href="#_verify-1">_verify</a></h3>
<pre><code class="language-solidity">function _verify(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    uint256[11] memory publicInput,
    IPlonkVerifier.PlonkProof memory proof
) private view returns (bool);
</code></pre>
<h3 id="_computechallenges-1"><a class="header" href="#_computechallenges-1">_computeChallenges</a></h3>
<pre><code class="language-solidity">function _computeChallenges(
    IPlonkVerifier.VerifyingKey memory vk,
    uint256[11] memory pi,
    IPlonkVerifier.PlonkProof memory proof
) internal pure returns (Challenges memory res);
</code></pre>
<h3 id="_computelinpolyconstantterm-1"><a class="header" href="#_computelinpolyconstantterm-1">_computeLinPolyConstantTerm</a></h3>
<p>Compute the constant term of the linearization polynomial.</p>
<pre><code>r_plonk = PI - L1(x) * alpha^2 - alpha * \prod_i=1..m-1 (w_i + beta * sigma_i + gamma) *
(w_m + gamma) * z(xw)
</code></pre>
<p>where m is the number of wire types.</p>
<pre><code class="language-solidity">function _computeLinPolyConstantTerm(
    Challenges memory chal,
    IPlonkVerifier.PlonkProof memory proof,
    Poly.EvalData memory evalData
) internal pure returns (uint256 res);
</code></pre>
<h3 id="_preparepolycommitments-1"><a class="header" href="#_preparepolycommitments-1">_preparePolyCommitments</a></h3>
<pre><code class="language-solidity">function _preparePolyCommitments(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    Challenges memory chal,
    Poly.EvalData memory evalData,
    IPlonkVerifier.PlonkProof memory proof
) internal view returns (BN254.G1Point memory e1, BN254.G1Point memory f1);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>e1</code></td><td><code>BN254.G1Point</code></td><td>The [E]1 in Sec 8.4, step 11 of Plonk</td></tr>
<tr><td><code>f1</code></td><td><code>BN254.G1Point</code></td><td>The [F]1 in Sec 8.4, step 10 of Plonk</td></tr>
</tbody>
</table>
</div>
<h3 id="_linearizationpolycomm-1"><a class="header" href="#_linearizationpolycomm-1">_linearizationPolyComm</a></h3>
<p>Compute the linearization poly commitment</p>
<pre><code class="language-solidity">function _linearizationPolyComm(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    Challenges memory challenge,
    Poly.EvalData memory evalData,
    IPlonkVerifier.PlonkProof memory proof
) private view returns (BN254.G1Point memory d1);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>verifyingKey</code></td><td><code>IPlonkVerifier.VerifyingKey</code></td><td>The verifying key</td></tr>
<tr><td><code>challenge</code></td><td><code>Challenges</code></td><td>A set of challenges</td></tr>
<tr><td><code>evalData</code></td><td><code>Poly.EvalData</code></td><td>Polynomial evaluation data</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>A Plonk proof</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>d1</code></td><td><code>BN254.G1Point</code></td><td>The [D]1 in Step 9 of Plonk</td></tr>
</tbody>
</table>
</div>
<h2 id="errors-3"><a class="header" href="#errors-3">Errors</a></h2>
<h3 id="invalidplonkargs-1"><a class="header" href="#invalidplonkargs-1">InvalidPlonkArgs</a></h3>
<p>Plonk: invalid inputs, either mismatching lengths among input arguments
or empty input.</p>
<pre><code class="language-solidity">error InvalidPlonkArgs();
</code></pre>
<h3 id="wrongplonkvk-1"><a class="header" href="#wrongplonkvk-1">WrongPlonkVK</a></h3>
<p>Plonk: wrong verification key used.</p>
<pre><code class="language-solidity">error WrongPlonkVK();
</code></pre>
<h2 id="structs-4"><a class="header" href="#structs-4">Structs</a></h2>
<h3 id="challenges-1"><a class="header" href="#challenges-1">Challenges</a></h3>
<p>Plonk IOP verifier challenges.</p>
<pre><code class="language-solidity">struct Challenges {
    uint256 alpha; // 0x00
    uint256 alpha2; // 0x20
    uint256 alpha3; // 0x40
    uint256 beta; // 0x60
    uint256 gamma; // 0x80
    uint256 zeta; // 0xA0
    uint256 v; // 0xC0
    uint256 u; // 0xE0
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="plonkverifierv3"><a class="header" href="#plonkverifierv3">PlonkVerifierV3</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/PlonkVerifierV3.sol">Git Source</a></p>
<p>The TurboPlonk formula is:
qo * wo = pub_input + q_c +
q_mul0 * w0 * w1 + q_mul1 * w2 * w3 +
q_lc0 * w0 + q_lc1 * w1 + q_lc2 * w2 + q_lc3 * w3 +
q_hash0 * w0 + q_hash1 * w1 + q_hash2 * w2 + q_hash3 * w3 +
q_ecc * w0 * w1 * w2 * w3 * wo</p>
<h2 id="state-variables-3"><a class="header" href="#state-variables-3">State Variables</a></h2>
<h3 id="coset_k1-2"><a class="header" href="#coset_k1-2">COSET_K1</a></h3>
<pre><code class="language-solidity">uint256 public constant COSET_K1 =
    0x2f8dd1f1a7583c42c4e12a44e110404c73ca6c94813f85835da4fb7bb1301d4a
</code></pre>
<h3 id="coset_k2-2"><a class="header" href="#coset_k2-2">COSET_K2</a></h3>
<pre><code class="language-solidity">uint256 public constant COSET_K2 =
    0x1ee678a0470a75a6eaa8fe837060498ba828a3703b311d0f77f010424afeb025
</code></pre>
<h3 id="coset_k3-2"><a class="header" href="#coset_k3-2">COSET_K3</a></h3>
<pre><code class="language-solidity">uint256 public constant COSET_K3 =
    0x2042a587a90c187b0a087c03e29c968b950b1db26d5c82d666905a6895790c0a
</code></pre>
<h3 id="coset_k4-2"><a class="header" href="#coset_k4-2">COSET_K4</a></h3>
<pre><code class="language-solidity">uint256 public constant COSET_K4 =
    0x2e2b91456103698adf57b799969dea1c8f739da5d8d40dd3eb9222db7c81e881
</code></pre>
<h3 id="beta_h_x0-2"><a class="header" href="#beta_h_x0-2">BETA_H_X0</a></h3>
<pre><code class="language-solidity">uint256 public constant BETA_H_X0 =
    0x260e01b251f6f1c7e7ff4e580791dee8ea51d87a358e038b4efe30fac09383c1
</code></pre>
<h3 id="beta_h_x1-2"><a class="header" href="#beta_h_x1-2">BETA_H_X1</a></h3>
<pre><code class="language-solidity">uint256 public constant BETA_H_X1 =
    0x0118c4d5b837bcc2bc89b5b398b5974e9f5944073b32078b7e231fec938883b0
</code></pre>
<h3 id="beta_h_y0-2"><a class="header" href="#beta_h_y0-2">BETA_H_Y0</a></h3>
<pre><code class="language-solidity">uint256 public constant BETA_H_Y0 =
    0x04fc6369f7110fe3d25156c1bb9a72859cf2a04641f99ba4ee413c80da6a5fe4
</code></pre>
<h3 id="beta_h_y1-2"><a class="header" href="#beta_h_y1-2">BETA_H_Y1</a></h3>
<pre><code class="language-solidity">uint256 public constant BETA_H_Y1 =
    0x22febda3c0c0632a56475b4214e5615e11e6dd3f96e6cea2854a87d4dacc5e55
</code></pre>
<h3 id="num_wire_types-2"><a class="header" href="#num_wire_types-2">NUM_WIRE_TYPES</a></h3>
<p>The number of wire types of the circuit, TurboPlonk has 5.</p>
<pre><code class="language-solidity">uint256 internal constant NUM_WIRE_TYPES = 5
</code></pre>
<h2 id="functions-12"><a class="header" href="#functions-12">Functions</a></h2>
<h3 id="verify-3"><a class="header" href="#verify-3">verify</a></h3>
<p>Verify a single TurboPlonk proofs.</p>
<pre><code class="language-solidity">function verify(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    uint256[5] memory publicInput,
    IPlonkVerifier.PlonkProof memory proof
) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>verifyingKey</code></td><td><code>IPlonkVerifier.VerifyingKey</code></td><td>The Plonk verification key</td></tr>
<tr><td><code>publicInput</code></td><td><code>uint256[5]</code></td><td>The public input fields</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>The TurboPlonk proof</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>_ A boolean indicating successful verification, false otherwise</td></tr>
</tbody>
</table>
</div>
<h3 id="_validateproof-2"><a class="header" href="#_validateproof-2">_validateProof</a></h3>
<p>Validate all group points and scalar fields. Revert if
any are invalid.</p>
<pre><code class="language-solidity">function _validateProof(IPlonkVerifier.PlonkProof memory proof) internal pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>A Plonk proof</td></tr>
</tbody>
</table>
</div>
<h3 id="_verify-2"><a class="header" href="#_verify-2">_verify</a></h3>
<pre><code class="language-solidity">function _verify(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    uint256[5] memory publicInput,
    IPlonkVerifier.PlonkProof memory proof
) private view returns (bool);
</code></pre>
<h3 id="_computechallenges-2"><a class="header" href="#_computechallenges-2">_computeChallenges</a></h3>
<pre><code class="language-solidity">function _computeChallenges(
    IPlonkVerifier.VerifyingKey memory vk,
    uint256[5] memory pi,
    IPlonkVerifier.PlonkProof memory proof
) internal pure returns (Challenges memory res);
</code></pre>
<h3 id="_computelinpolyconstantterm-2"><a class="header" href="#_computelinpolyconstantterm-2">_computeLinPolyConstantTerm</a></h3>
<p>Compute the constant term of the linearization polynomial.</p>
<pre><code>r_plonk = PI - L1(x) * alpha^2 - alpha * \prod_i=1..m-1 (w_i + beta * sigma_i + gamma) *
(w_m + gamma) * z(xw)
</code></pre>
<p>where m is the number of wire types.</p>
<pre><code class="language-solidity">function _computeLinPolyConstantTerm(
    Challenges memory chal,
    IPlonkVerifier.PlonkProof memory proof,
    Poly.EvalData memory evalData
) internal pure returns (uint256 res);
</code></pre>
<h3 id="_preparepolycommitments-2"><a class="header" href="#_preparepolycommitments-2">_preparePolyCommitments</a></h3>
<pre><code class="language-solidity">function _preparePolyCommitments(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    Challenges memory chal,
    Poly.EvalData memory evalData,
    IPlonkVerifier.PlonkProof memory proof
) internal view returns (BN254.G1Point memory e1, BN254.G1Point memory f1);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>e1</code></td><td><code>BN254.G1Point</code></td><td>The [E]1 in Sec 8.4, step 11 of Plonk</td></tr>
<tr><td><code>f1</code></td><td><code>BN254.G1Point</code></td><td>The [F]1 in Sec 8.4, step 10 of Plonk</td></tr>
</tbody>
</table>
</div>
<h3 id="_linearizationpolycomm-2"><a class="header" href="#_linearizationpolycomm-2">_linearizationPolyComm</a></h3>
<p>Compute the linearization poly commitment</p>
<pre><code class="language-solidity">function _linearizationPolyComm(
    IPlonkVerifier.VerifyingKey memory verifyingKey,
    Challenges memory challenge,
    Poly.EvalData memory evalData,
    IPlonkVerifier.PlonkProof memory proof
) private view returns (BN254.G1Point memory d1);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>verifyingKey</code></td><td><code>IPlonkVerifier.VerifyingKey</code></td><td>The verifying key</td></tr>
<tr><td><code>challenge</code></td><td><code>Challenges</code></td><td>A set of challenges</td></tr>
<tr><td><code>evalData</code></td><td><code>Poly.EvalData</code></td><td>Polynomial evaluation data</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>A Plonk proof</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>d1</code></td><td><code>BN254.G1Point</code></td><td>The [D]1 in Step 9 of Plonk</td></tr>
</tbody>
</table>
</div>
<h2 id="errors-4"><a class="header" href="#errors-4">Errors</a></h2>
<h3 id="invalidplonkargs-2"><a class="header" href="#invalidplonkargs-2">InvalidPlonkArgs</a></h3>
<p>Plonk: invalid inputs, either mismatching lengths among input arguments
or empty input.</p>
<pre><code class="language-solidity">error InvalidPlonkArgs();
</code></pre>
<h3 id="wrongplonkvk-2"><a class="header" href="#wrongplonkvk-2">WrongPlonkVK</a></h3>
<p>Plonk: wrong verification key used.</p>
<pre><code class="language-solidity">error WrongPlonkVK();
</code></pre>
<h2 id="structs-5"><a class="header" href="#structs-5">Structs</a></h2>
<h3 id="challenges-2"><a class="header" href="#challenges-2">Challenges</a></h3>
<p>Plonk IOP verifier challenges.</p>
<pre><code class="language-solidity">struct Challenges {
    uint256 alpha; // 0x00
    uint256 alpha2; // 0x20
    uint256 alpha3; // 0x40
    uint256 beta; // 0x60
    uint256 gamma; // 0x80
    uint256 zeta; // 0xA0
    uint256 v; // 0xC0
    uint256 u; // 0xE0
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="polynomialeval"><a class="header" href="#polynomialeval">PolynomialEval</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/PolynomialEval.sol">Git Source</a></p>
<h2 id="functions-13"><a class="header" href="#functions-13">Functions</a></h2>
<h3 id="newevaldomain"><a class="header" href="#newevaldomain">newEvalDomain</a></h3>
<p>Create a new Radix2EvalDomain with <code>domainSize</code> which should be power of 2.</p>
<p>Will revert if domainSize is not among {2^5, 2^16, 2^20}</p>
<p>The hardcoded values are generated by the rust script <code>eval-domain</code>.</p>
<pre><code class="language-solidity">function newEvalDomain(uint256 domainSize) internal pure returns (EvalDomain memory);
</code></pre>
<h3 id="evaluatevanishingpoly"><a class="header" href="#evaluatevanishingpoly">evaluateVanishingPoly</a></h3>
<pre><code class="language-solidity">function evaluateVanishingPoly(EvalDomain memory self, uint256 zeta)
    internal
    pure
    returns (uint256 res);
</code></pre>
<h3 id="evaluatelagrangeone"><a class="header" href="#evaluatelagrangeone">evaluateLagrangeOne</a></h3>
<p>Evaluate the lagrange polynomial at point <code>zeta</code> given the vanishing polynomial
evaluation <code>vanish_eval</code>.</p>
<pre><code class="language-solidity">function evaluateLagrangeOne(
    EvalDomain memory self,
    BN254.ScalarField zeta,
    BN254.ScalarField vanishEval
) internal view returns (BN254.ScalarField res);
</code></pre>
<h3 id="evaluatepipoly"><a class="header" href="#evaluatepipoly">evaluatePiPoly</a></h3>
<p>Evaluate public input polynomial at point <code>zeta</code>.</p>
<pre><code class="language-solidity">function evaluatePiPoly(
    EvalDomain memory self,
    uint256[7] memory pi,
    uint256 zeta,
    uint256 vanishingPolyEval
) internal view returns (uint256 res);
</code></pre>
<h3 id="evaldatagen"><a class="header" href="#evaldatagen">evalDataGen</a></h3>
<p>compute the EvalData for a given domain and a challenge zeta</p>
<pre><code class="language-solidity">function evalDataGen(EvalDomain memory self, uint256 zeta, uint256[7] memory publicInput)
    internal
    view
    returns (EvalData memory evalData);
</code></pre>
<h2 id="errors-5"><a class="header" href="#errors-5">Errors</a></h2>
<h3 id="unsupporteddegree"><a class="header" href="#unsupporteddegree">UnsupportedDegree</a></h3>
<p>Unsupported polynomial degree, currently size must in 2^{14~17}.</p>
<pre><code class="language-solidity">error UnsupportedDegree();
</code></pre>
<h2 id="structs-6"><a class="header" href="#structs-6">Structs</a></h2>
<h3 id="evaldomain"><a class="header" href="#evaldomain">EvalDomain</a></h3>
<p>a Radix 2 Evaluation Domain</p>
<pre><code class="language-solidity">struct EvalDomain {
    uint256 logSize; // log_2(self.size)
    uint256 sizeInv; // Inverse of the size in the field
    uint256[7] elements; // 1, g, g^2, ..., g^6
}
</code></pre>
<h3 id="evaldata"><a class="header" href="#evaldata">EvalData</a></h3>
<p>stores vanishing poly, lagrange at 1, and Public input poly</p>
<pre><code class="language-solidity">struct EvalData {
    BN254.ScalarField vanishEval;
    BN254.ScalarField lagrangeOne;
    BN254.ScalarField piEval;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="polynomialevalv2"><a class="header" href="#polynomialevalv2">PolynomialEvalV2</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/PolynomialEvalV2.sol">Git Source</a></p>
<h2 id="functions-14"><a class="header" href="#functions-14">Functions</a></h2>
<h3 id="newevaldomain-1"><a class="header" href="#newevaldomain-1">newEvalDomain</a></h3>
<p>Create a new Radix2EvalDomain with <code>domainSize</code> which should be power of 2.</p>
<p>Will revert if domainSize is not among {2^5, 2^16, 2^20}</p>
<p>The hardcoded values are generated by the rust script <code>eval-domain</code>.</p>
<pre><code class="language-solidity">function newEvalDomain(uint256 domainSize) internal pure returns (EvalDomain memory);
</code></pre>
<h3 id="evaluatevanishingpoly-1"><a class="header" href="#evaluatevanishingpoly-1">evaluateVanishingPoly</a></h3>
<pre><code class="language-solidity">function evaluateVanishingPoly(EvalDomain memory domain, uint256 zeta)
    internal
    pure
    returns (uint256 res);
</code></pre>
<h3 id="evaluatelagrangeone-1"><a class="header" href="#evaluatelagrangeone-1">evaluateLagrangeOne</a></h3>
<p>Evaluate the lagrange polynomial at point <code>zeta</code> given the vanishing polynomial
evaluation <code>vanish_eval</code>.</p>
<pre><code class="language-solidity">function evaluateLagrangeOne(
    EvalDomain memory domain,
    BN254.ScalarField zeta,
    BN254.ScalarField vanishEval
) internal view returns (BN254.ScalarField res);
</code></pre>
<h3 id="evaluatepipoly-1"><a class="header" href="#evaluatepipoly-1">evaluatePiPoly</a></h3>
<p>Evaluate public input polynomial at point <code>zeta</code>.</p>
<pre><code class="language-solidity">function evaluatePiPoly(
    EvalDomain memory domain,
    uint256[11] memory pi,
    uint256 zeta,
    uint256 vanishingPolyEval
) internal view returns (uint256 res);
</code></pre>
<h3 id="evaldatagen-1"><a class="header" href="#evaldatagen-1">evalDataGen</a></h3>
<p>compute the EvalData for a given domain and a challenge zeta</p>
<pre><code class="language-solidity">function evalDataGen(EvalDomain memory domain, uint256 zeta, uint256[11] memory publicInput)
    internal
    view
    returns (EvalData memory evalData);
</code></pre>
<h2 id="errors-6"><a class="header" href="#errors-6">Errors</a></h2>
<h3 id="unsupporteddegree-1"><a class="header" href="#unsupporteddegree-1">UnsupportedDegree</a></h3>
<p>Unsupported polynomial degree, currently size must in 2^{14~17}.</p>
<pre><code class="language-solidity">error UnsupportedDegree();
</code></pre>
<h2 id="structs-7"><a class="header" href="#structs-7">Structs</a></h2>
<h3 id="evaldomain-1"><a class="header" href="#evaldomain-1">EvalDomain</a></h3>
<p>a Radix 2 Evaluation Domain</p>
<pre><code class="language-solidity">struct EvalDomain {
    uint256 logSize; // log_2(domain.size)
    uint256 sizeInv; // Inverse of the size in the field
    uint256[11] elements; // 1, g, g^2, ..., g^10
}
</code></pre>
<h3 id="evaldata-1"><a class="header" href="#evaldata-1">EvalData</a></h3>
<p>stores vanishing poly, lagrange at 1, and Public input poly</p>
<pre><code class="language-solidity">struct EvalData {
    BN254.ScalarField vanishEval;
    BN254.ScalarField lagrangeOne;
    BN254.ScalarField piEval;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="polynomialevalv3"><a class="header" href="#polynomialevalv3">PolynomialEvalV3</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/PolynomialEvalV3.sol">Git Source</a></p>
<h2 id="functions-15"><a class="header" href="#functions-15">Functions</a></h2>
<h3 id="newevaldomain-2"><a class="header" href="#newevaldomain-2">newEvalDomain</a></h3>
<p>Create a new Radix2EvalDomain with <code>domainSize</code> which should be power of 2.</p>
<p>Will revert if domainSize is not among {2^5, 2^16, 2^20}</p>
<p>The hardcoded values are generated by the rust script <code>eval-domain</code>.</p>
<pre><code class="language-solidity">function newEvalDomain(uint256 domainSize) internal pure returns (EvalDomain memory);
</code></pre>
<h3 id="evaluatevanishingpoly-2"><a class="header" href="#evaluatevanishingpoly-2">evaluateVanishingPoly</a></h3>
<pre><code class="language-solidity">function evaluateVanishingPoly(EvalDomain memory domain, uint256 zeta)
    internal
    pure
    returns (uint256 res);
</code></pre>
<h3 id="evaluatelagrangeone-2"><a class="header" href="#evaluatelagrangeone-2">evaluateLagrangeOne</a></h3>
<p>Evaluate the lagrange polynomial at point <code>zeta</code> given the vanishing polynomial
evaluation <code>vanish_eval</code>.</p>
<pre><code class="language-solidity">function evaluateLagrangeOne(
    EvalDomain memory domain,
    BN254.ScalarField zeta,
    BN254.ScalarField vanishEval
) internal view returns (BN254.ScalarField res);
</code></pre>
<h3 id="evaluatepipoly-2"><a class="header" href="#evaluatepipoly-2">evaluatePiPoly</a></h3>
<p>Evaluate public input polynomial at point <code>zeta</code>.</p>
<pre><code class="language-solidity">function evaluatePiPoly(
    EvalDomain memory domain,
    uint256[5] memory pi,
    uint256 zeta,
    uint256 vanishingPolyEval
) internal view returns (uint256 res);
</code></pre>
<h3 id="evaldatagen-2"><a class="header" href="#evaldatagen-2">evalDataGen</a></h3>
<p>compute the EvalData for a given domain and a challenge zeta</p>
<pre><code class="language-solidity">function evalDataGen(EvalDomain memory domain, uint256 zeta, uint256[5] memory publicInput)
    internal
    view
    returns (EvalData memory evalData);
</code></pre>
<h2 id="errors-7"><a class="header" href="#errors-7">Errors</a></h2>
<h3 id="unsupporteddegree-2"><a class="header" href="#unsupporteddegree-2">UnsupportedDegree</a></h3>
<p>Unsupported polynomial degree, currently size must in 2^{14~17}.</p>
<pre><code class="language-solidity">error UnsupportedDegree();
</code></pre>
<h2 id="structs-8"><a class="header" href="#structs-8">Structs</a></h2>
<h3 id="evaldomain-2"><a class="header" href="#evaldomain-2">EvalDomain</a></h3>
<p>a Radix 2 Evaluation Domain</p>
<pre><code class="language-solidity">struct EvalDomain {
    uint256 logSize; // log_2(domain.size)
    uint256 sizeInv; // Inverse of the size in the field
    uint256[5] elements; // 1, g, g^2, g^3, g^4
}
</code></pre>
<h3 id="evaldata-2"><a class="header" href="#evaldata-2">EvalData</a></h3>
<p>stores vanishing poly, lagrange at 1, and Public input poly</p>
<pre><code class="language-solidity">struct EvalData {
    BN254.ScalarField vanishEval;
    BN254.ScalarField lagrangeOne;
    BN254.ScalarField piEval;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rewardmerkletreeverifier"><a class="header" href="#rewardmerkletreeverifier">RewardMerkleTreeVerifier</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/libraries/RewardMerkleTreeVerifier.sol">Git Source</a></p>
<p><strong>Title:</strong>
RewardMerkleTreeVerifier</p>
<p>Solidity verifier for RewardMerkleTreeV2 compatible with Espresso’s reward system</p>
<ul>
<li>Arity: 2 (binary tree)</li>
<li>Depth: 160 levels</li>
<li>Key length: 20 bytes (160 bits) - Ethereum addresses</li>
<li>EVM native keccak hash</li>
<li>Double hashing of leaves as cheap domain separator</li>
</ul>
<h2 id="state-variables-4"><a class="header" href="#state-variables-4">State Variables</a></h2>
<h3 id="tree_depth"><a class="header" href="#tree_depth">TREE_DEPTH</a></h3>
<pre><code class="language-solidity">uint256 public constant TREE_DEPTH = 160
</code></pre>
<h2 id="functions-16"><a class="header" href="#functions-16">Functions</a></h2>
<h3 id="_hashleaf"><a class="header" href="#_hashleaf">_hashLeaf</a></h3>
<pre><code class="language-solidity">function _hashLeaf(uint256 value) internal pure returns (bytes32);
</code></pre>
<h3 id="_hashinternal"><a class="header" href="#_hashinternal">_hashInternal</a></h3>
<pre><code class="language-solidity">function _hashInternal(bytes32 left, bytes32 right) internal pure returns (bytes32 hash);
</code></pre>
<h3 id="computeroot"><a class="header" href="#computeroot">computeRoot</a></h3>
<p>Compute reward commitment from a key-value pair and proof.</p>
<p>Designed to authenticate non-zero values for non-zero keys; caller must ensure
neither key nor value is zero.</p>
<pre><code class="language-solidity">function computeRoot(address key, uint256 value, bytes32[TREE_DEPTH] memory proof)
    internal
    pure
    returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>key</code></td><td><code>address</code></td><td>The key to prove - Ethereum address</td></tr>
<tr><td><code>value</code></td><td><code>uint256</code></td><td>The value to prove - lifetime earned rewards amount</td></tr>
<tr><td><code>proof</code></td><td><code>bytes32[TREE_DEPTH]</code></td><td>The membership proof containing sibling hashes and numLeaves</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>The computed reward commitment</td></tr>
</tbody>
</table>
</div>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="esptoken"><a class="header" href="#esptoken">EspToken</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/EspToken.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Initializable, ERC20Upgradeable, OwnableUpgradeable, UUPSUpgradeable</p>
<p><strong>Title:</strong>
EspToken</p>
<p>ERC20 token for the Espresso network, upgradeable via UUPS.</p>
<p>Upgradeability &amp; storage layout (frozen-inheritance pattern)
We intentionally do not use <code>__gap</code> slots. Once a version is deployed,
its storage layout is frozen and never modified. New state variables are
added only in a new child contract (V2, V3, …) that inherits from the
previous version and appends fields at the end. This preserves slot order
across upgrades without relying on gaps. (Note: upstream OZ parents may
include their own gaps—those remain untouched.)</p>
<h2 id="functions-17"><a class="header" href="#functions-17">Functions</a></h2>
<h3 id="constructor-1"><a class="header" href="#constructor-1">constructor</a></h3>
<p>since the constructor initializes storage on this contract we disable it</p>
<p>storage is on the proxy contract since it calls this contract via delegatecall</p>
<p><strong>Note:</strong>
oz-upgrades-unsafe-allow: constructor</p>
<pre><code class="language-solidity">constructor() ;
</code></pre>
<h3 id="initialize"><a class="header" href="#initialize">initialize</a></h3>
<p>This contract is called by the proxy when you deploy this contract</p>
<pre><code class="language-solidity">function initialize(
    address owner,
    address initialRecipient,
    uint256 initialSupply,
    string memory name,
    string memory symbol
) public initializer;
</code></pre>
<h3 id="_authorizeupgrade"><a class="header" href="#_authorizeupgrade">_authorizeUpgrade</a></h3>
<p>only the owner can authorize an upgrade</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal virtual override onlyOwner;
</code></pre>
<h3 id="renounceownership"><a class="header" href="#renounceownership">renounceOwnership</a></h3>
<p>Cannot renounce ownership</p>
<p>Override renounceOwnership() to revert, preventing accidental or malicious ownership
renunciation</p>
<pre><code class="language-solidity">function renounceOwnership() public virtual override onlyOwner;
</code></pre>
<h3 id="getversion"><a class="header" href="#getversion">getVersion</a></h3>
<p>Use this to get the implementation contract version</p>
<pre><code class="language-solidity">function getVersion()
    public
    pure
    virtual
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<h2 id="errors-8"><a class="header" href="#errors-8">Errors</a></h2>
<h3 id="ownershipcannotberenounced"><a class="header" href="#ownershipcannotberenounced">OwnershipCannotBeRenounced</a></h3>
<p>Cannot renounce ownership</p>
<pre><code class="language-solidity">error OwnershipCannotBeRenounced();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="esptokenv2"><a class="header" href="#esptokenv2">EspTokenV2</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/EspTokenV2.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/contracts/src/EspToken.sol/contract.EspToken.html">EspToken</a></p>
<p><strong>Title:</strong>
EspTokenV2</p>
<p>Upgrades EspToken to allow minting by the RewardClaim contract</p>
<p>Upgradeability &amp; storage layout (frozen-inheritance pattern)
We intentionally do not use <code>__gap</code> slots. Once a version is deployed,
its storage layout is frozen and never modified. New state variables are
added only in a new child contract (V2, V3, …) that inherits from the
previous version and appends fields at the end. This preserves slot order
across upgrades without relying on gaps. (Note: upstream OZ parents may
include their own gaps—those remain untouched.)</p>
<h2 id="state-variables-5"><a class="header" href="#state-variables-5">State Variables</a></h2>
<h3 id="rewardclaim"><a class="header" href="#rewardclaim">rewardClaim</a></h3>
<p>Address of the RewardClaim contract authorized to mint tokens</p>
<p>Can only be set once, during initialization.</p>
<pre><code class="language-solidity">address public rewardClaim
</code></pre>
<h2 id="functions-18"><a class="header" href="#functions-18">Functions</a></h2>
<h3 id="constructor-2"><a class="header" href="#constructor-2">constructor</a></h3>
<pre><code class="language-solidity">constructor() ;
</code></pre>
<h3 id="initializev2"><a class="header" href="#initializev2">initializeV2</a></h3>
<p>Initializes the V2 upgrade with the RewardClaim contract address</p>
<pre><code class="language-solidity">function initializeV2(address _rewardClaim) public onlyOwner reinitializer(2);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>_rewardClaim</code></td><td><code>address</code></td><td>Address of the RewardClaim contract</td></tr>
</tbody>
</table>
</div>
<h3 id="mint"><a class="header" href="#mint">mint</a></h3>
<p>Mints new tokens to a specified address</p>
<p>Only the RewardClaim contract can mint new tokens</p>
<pre><code class="language-solidity">function mint(address to, uint256 amount) public;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>Address to receive the minted tokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>Number of tokens to mint</td></tr>
</tbody>
</table>
</div>
<h3 id="getversion-1"><a class="header" href="#getversion-1">getVersion</a></h3>
<p>Returns the contract version</p>
<pre><code class="language-solidity">function getVersion()
    public
    pure
    virtual
    override
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>majorVersion</code></td><td><code>uint8</code></td><td>Major version number</td></tr>
<tr><td><code>minorVersion</code></td><td><code>uint8</code></td><td>Minor version number</td></tr>
<tr><td><code>patchVersion</code></td><td><code>uint8</code></td><td>Patch version number</td></tr>
</tbody>
</table>
</div>
<h2 id="errors-9"><a class="header" href="#errors-9">Errors</a></h2>
<h3 id="onlyrewardclaim"><a class="header" href="#onlyrewardclaim">OnlyRewardClaim</a></h3>
<p>A non-RewardClaim address attempts to mint</p>
<pre><code class="language-solidity">error OnlyRewardClaim();
</code></pre>
<h3 id="zerorewardclaimaddress"><a class="header" href="#zerorewardclaimaddress">ZeroRewardClaimAddress</a></h3>
<p>RewardClaim address cannot be zero</p>
<pre><code class="language-solidity">error ZeroRewardClaimAddress();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="feecontract"><a class="header" href="#feecontract">FeeContract</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/FeeContract.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Initializable, OwnableUpgradeable, UUPSUpgradeable</p>
<h2 id="state-variables-6"><a class="header" href="#state-variables-6">State Variables</a></h2>
<h3 id="maxdepositamount"><a class="header" href="#maxdepositamount">maxDepositAmount</a></h3>
<p>max amount allowed to be deposited to prevent fat finger errors</p>
<pre><code class="language-solidity">uint256 public maxDepositAmount
</code></pre>
<h3 id="mindepositamount"><a class="header" href="#mindepositamount">minDepositAmount</a></h3>
<pre><code class="language-solidity">uint256 public minDepositAmount
</code></pre>
<h3 id="balances"><a class="header" href="#balances">balances</a></h3>
<p>store user balances in a mapping</p>
<pre><code class="language-solidity">mapping(address user =&gt; uint256 amount) public balances
</code></pre>
<h2 id="functions-19"><a class="header" href="#functions-19">Functions</a></h2>
<h3 id="constructor-3"><a class="header" href="#constructor-3">constructor</a></h3>
<p>since the constructor initializes storage on this contract we disable it</p>
<p>storage is on the proxy contract since it calls this contract via delegatecall</p>
<p><strong>Note:</strong>
oz-upgrades-unsafe-allow: constructor</p>
<pre><code class="language-solidity">constructor() ;
</code></pre>
<h3 id="initialize-1"><a class="header" href="#initialize-1">initialize</a></h3>
<p>This contract is called by the proxy when you deploy this contract</p>
<pre><code class="language-solidity">function initialize(address multisig) public initializer;
</code></pre>
<h3 id="fallback"><a class="header" href="#fallback">fallback</a></h3>
<p>Revert if a method name does not exist</p>
<pre><code class="language-solidity">fallback() external payable;
</code></pre>
<h3 id="receive"><a class="header" href="#receive">receive</a></h3>
<p>Revert if no method name was called</p>
<pre><code class="language-solidity">receive() external payable;
</code></pre>
<h3 id="deposit"><a class="header" href="#deposit">deposit</a></h3>
<p>Allows anyone to deposit an ETH balance for any user</p>
<p>the deposit amount is less than a specified threshold to prevent fat finger errors</p>
<pre><code class="language-solidity">function deposit(address user) public payable;
</code></pre>
<h3 id="_authorizeupgrade-1"><a class="header" href="#_authorizeupgrade-1">_authorizeUpgrade</a></h3>
<p>only the owner can authorize an upgrade</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal override onlyOwner;
</code></pre>
<h3 id="renounceownership-1"><a class="header" href="#renounceownership-1">renounceOwnership</a></h3>
<p>Cannot renounce ownership</p>
<p>Override renounceOwnership() to revert, preventing accidental or malicious ownership
renunciation</p>
<pre><code class="language-solidity">function renounceOwnership() public virtual override onlyOwner;
</code></pre>
<h3 id="getversion-2"><a class="header" href="#getversion-2">getVersion</a></h3>
<p>Use this to get the implementation contract version</p>
<pre><code class="language-solidity">function getVersion()
    public
    pure
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<h2 id="events-1"><a class="header" href="#events-1">Events</a></h2>
<h3 id="deposit-1"><a class="header" href="#deposit-1">Deposit</a></h3>
<p>Notify a new deposit</p>
<pre><code class="language-solidity">event Deposit(address indexed user, uint256 amount);
</code></pre>
<h3 id="log"><a class="header" href="#log">Log</a></h3>
<pre><code class="language-solidity">event Log(string func, uint256 gas);
</code></pre>
<h3 id="upgrade"><a class="header" href="#upgrade">Upgrade</a></h3>
<p>upgrade event when the proxy updates the implementation it’s pointing to</p>
<pre><code class="language-solidity">event Upgrade(address implementation);
</code></pre>
<h2 id="errors-10"><a class="header" href="#errors-10">Errors</a></h2>
<h3 id="invaliduseraddress"><a class="header" href="#invaliduseraddress">InvalidUserAddress</a></h3>
<p>error types</p>
<pre><code class="language-solidity">error InvalidUserAddress();
</code></pre>
<h3 id="deposittoolarge"><a class="header" href="#deposittoolarge">DepositTooLarge</a></h3>
<pre><code class="language-solidity">error DepositTooLarge();
</code></pre>
<h3 id="deposittoosmall"><a class="header" href="#deposittoosmall">DepositTooSmall</a></h3>
<pre><code class="language-solidity">error DepositTooSmall();
</code></pre>
<h3 id="functiondoesnotexist"><a class="header" href="#functiondoesnotexist">FunctionDoesNotExist</a></h3>
<pre><code class="language-solidity">error FunctionDoesNotExist();
</code></pre>
<h3 id="nofunctioncalled"><a class="header" href="#nofunctioncalled">NoFunctionCalled</a></h3>
<pre><code class="language-solidity">error NoFunctionCalled();
</code></pre>
<h3 id="ownershipcannotberenounced-1"><a class="header" href="#ownershipcannotberenounced-1">OwnershipCannotBeRenounced</a></h3>
<pre><code class="language-solidity">error OwnershipCannotBeRenounced();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="initializedat"><a class="header" href="#initializedat">InitializedAt</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/InitializedAt.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Initializable</p>
<h2 id="state-variables-7"><a class="header" href="#state-variables-7">State Variables</a></h2>
<h3 id="initializedatblock"><a class="header" href="#initializedatblock">initializedAtBlock</a></h3>
<pre><code class="language-solidity">uint256 public initializedAtBlock
</code></pre>
<h2 id="functions-20"><a class="header" href="#functions-20">Functions</a></h2>
<h3 id="constructor-4"><a class="header" href="#constructor-4">constructor</a></h3>
<pre><code class="language-solidity">constructor() ;
</code></pre>
<h3 id="initializeatblock"><a class="header" href="#initializeatblock">initializeAtBlock</a></h3>
<pre><code class="language-solidity">function initializeAtBlock() internal initializer;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lightclient"><a class="header" href="#lightclient">LightClient</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/LightClient.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Initializable, OwnableUpgradeable, UUPSUpgradeable</p>
<p><strong>Title:</strong>
Light Client Contract</p>
<p>This contract serves as an always-on client
that verifies HotShot’s state (Espresso’s consensus state) which can be used by
Rollup contracts on L1 (Ethereum).
This state is submitted by any state-prover with evidence which is
a SNARK proof that proves consensus.
This contract also keeps track of the current epoch.
For this version, the epoch is not used. <br>
The light client state primarily consists of:<br></p>
<ul>
<li>the merkle root of finalized block commitments,<br></li>
<li>the fee ledger commitment and <br></li>
<li>the active stake table commitment<br></li>
</ul>
<p>You can use this contract to keep track of its finalized states in safe,
authenticated ways.</p>
<h2 id="state-variables-8"><a class="header" href="#state-variables-8">State Variables</a></h2>
<h3 id="genesisstaketablestate"><a class="header" href="#genesisstaketablestate">genesisStakeTableState</a></h3>
<p>genesis stake commitment</p>
<pre><code class="language-solidity">StakeTableState public genesisStakeTableState
</code></pre>
<h3 id="genesisstate"><a class="header" href="#genesisstate">genesisState</a></h3>
<p>genesis block commitment</p>
<pre><code class="language-solidity">LightClientState public genesisState
</code></pre>
<h3 id="finalizedstate"><a class="header" href="#finalizedstate">finalizedState</a></h3>
<p>Finalized HotShot’s light client state</p>
<pre><code class="language-solidity">LightClientState public finalizedState
</code></pre>
<h3 id="permissionedprover"><a class="header" href="#permissionedprover">permissionedProver</a></h3>
<p>the address of the prover that can call the newFinalizedState function when the
contract is in permissioned prover mode. This address is address(0) when the contract is
not in permissioned prover mode</p>
<pre><code class="language-solidity">address public permissionedProver
</code></pre>
<h3 id="statehistoryretentionperiod"><a class="header" href="#statehistoryretentionperiod">stateHistoryRetentionPeriod</a></h3>
<p>Max number of seconds worth of state commitments to record based on this block
timestamp</p>
<pre><code class="language-solidity">uint32 public stateHistoryRetentionPeriod
</code></pre>
<h3 id="statehistoryfirstindex"><a class="header" href="#statehistoryfirstindex">stateHistoryFirstIndex</a></h3>
<p>index of first block in block state series</p>
<p>use this instead of index 0 since old states would be set to zero to keep storage costs
constant to stateHistoryRetentionPeriod</p>
<pre><code class="language-solidity">uint64 public stateHistoryFirstIndex
</code></pre>
<h3 id="statehistorycommitments"><a class="header" href="#statehistorycommitments">stateHistoryCommitments</a></h3>
<p>an array to store the L1 block heights, HotShot Block Heights and their respective
state history
commitments</p>
<pre><code class="language-solidity">StateHistoryCommitment[] public stateHistoryCommitments
</code></pre>
<h2 id="functions-21"><a class="header" href="#functions-21">Functions</a></h2>
<h3 id="constructor-5"><a class="header" href="#constructor-5">constructor</a></h3>
<p>Constructor disables initializers to prevent the implementation contract from being
initialized</p>
<p>This is standard practice for OpenZeppelin upgradeable contracts. Storage is on the
proxy contract
since it calls this cnotract via delegatecall</p>
<p><strong>Note:</strong>
oz-upgrades-unsafe-allow: constructor</p>
<pre><code class="language-solidity">constructor() ;
</code></pre>
<h3 id="initialize-2"><a class="header" href="#initialize-2">initialize</a></h3>
<p>This contract is called by the proxy when you deploy this contract</p>
<pre><code class="language-solidity">function initialize(
    LightClientState memory _genesis,
    StakeTableState memory _genesisStakeTableState,
    uint32 _stateHistoryRetentionPeriod,
    address owner
) public initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>_genesis</code></td><td><code>LightClientState</code></td><td>The initial state of the light client</td></tr>
<tr><td><code>_genesisStakeTableState</code></td><td><code>StakeTableState</code></td><td></td></tr>
<tr><td><code>_stateHistoryRetentionPeriod</code></td><td><code>uint32</code></td><td>The maximum retention period (in seconds) for the state history. the min retention period allowed is 1 hour and max 365 days</td></tr>
<tr><td><code>owner</code></td><td><code>address</code></td><td>The address of the contract owner</td></tr>
</tbody>
</table>
</div>
<h3 id="currentblocknumber"><a class="header" href="#currentblocknumber">currentBlockNumber</a></h3>
<p>returns the current block number</p>
<pre><code class="language-solidity">function currentBlockNumber() public view virtual returns (uint256);
</code></pre>
<h3 id="getversion-3"><a class="header" href="#getversion-3">getVersion</a></h3>
<p>Use this to get the implementation contract version</p>
<pre><code class="language-solidity">function getVersion()
    public
    pure
    virtual
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>majorVersion</code></td><td><code>uint8</code></td><td>The major version of the contract</td></tr>
<tr><td><code>minorVersion</code></td><td><code>uint8</code></td><td>The minor version of the contract</td></tr>
<tr><td><code>patchVersion</code></td><td><code>uint8</code></td><td>The patch version of the contract</td></tr>
</tbody>
</table>
</div>
<h3 id="_authorizeupgrade-2"><a class="header" href="#_authorizeupgrade-2">_authorizeUpgrade</a></h3>
<p>only the owner can authorize an upgrade</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal virtual override onlyOwner;
</code></pre>
<h3 id="renounceownership-2"><a class="header" href="#renounceownership-2">renounceOwnership</a></h3>
<p>Cannot renounce ownership</p>
<p>Override renounceOwnership() to revert, preventing accidental or malicious ownership
renunciation</p>
<pre><code class="language-solidity">function renounceOwnership() public virtual override onlyOwner;
</code></pre>
<h3 id="_initializestate"><a class="header" href="#_initializestate">_initializeState</a></h3>
<p>Initialization of contract variables happens in this method because the LightClient
contract is upgradable and thus has its constructor method disabled.</p>
<pre><code class="language-solidity">function _initializeState(
    LightClientState memory _genesis,
    StakeTableState memory _genesisStakeTableState,
    uint32 _stateHistoryRetentionPeriod
) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>_genesis</code></td><td><code>LightClientState</code></td><td>The initial state of the light client</td></tr>
<tr><td><code>_genesisStakeTableState</code></td><td><code>StakeTableState</code></td><td>The initial stake table state of the light client</td></tr>
<tr><td><code>_stateHistoryRetentionPeriod</code></td><td><code>uint32</code></td><td>The maximum retention period (in seconds) for the state history. The min retention period allowed is 1 hour and the max is 365 days.</td></tr>
</tbody>
</table>
</div>
<h3 id="newfinalizedstate"><a class="header" href="#newfinalizedstate">newFinalizedState</a></h3>
<p>Update the latest finalized light client state. It must be updated
periodically, especially an update for the last block for every
period has to be submitted
before any newer state can be accepted since the stake table commitments of that block
become the snapshots used for vote verifications later on.</p>
<p>While <code>newState.stakeTable*</code> refers to the (possibly) new stake table states,
the entire <code>newState</code> needs to be signed by stakers in <code>finalizedState</code></p>
<p>if the permissionedProver is set, only the permissionedProver can call this function</p>
<p>the state history for <code>stateHistoryRetentionPeriod</code> L1 blocks are also recorded in the
<code>stateHistoryCommitments</code> array</p>
<pre><code class="language-solidity">function newFinalizedState(
    LightClientState memory newState,
    IPlonkVerifier.PlonkProof memory proof
) external virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newState</code></td><td><code>LightClientState</code></td><td>new light client state</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>PlonkProof</td></tr>
</tbody>
</table>
</div>
<h3 id="_getvk"><a class="header" href="#_getvk">_getVk</a></h3>
<p>a technically unnecessary but luckily zero-cost indirection for the benefit of
having
<code>IPlonkVerifier.VerifyingKey</code> rust alloy bindings, included only if appear in a public func.</p>
<pre><code class="language-solidity">function _getVk() public pure virtual returns (IPlonkVerifier.VerifyingKey memory vk);
</code></pre>
<h3 id="verifyproof"><a class="header" href="#verifyproof">verifyProof</a></h3>
<p>Verify the Plonk proof, marked as <code>virtual</code> for easier testing as we can swap VK
used in inherited contracts.</p>
<pre><code class="language-solidity">function verifyProof(LightClientState memory state, IPlonkVerifier.PlonkProof memory proof)
    internal
    virtual;
</code></pre>
<h3 id="setpermissionedprover"><a class="header" href="#setpermissionedprover">setPermissionedProver</a></h3>
<p>set the permissionedProver to the non-zero address provided</p>
<p>this function can also be used to update the permissioned prover once it’s a different
address to the current permissioned prover</p>
<pre><code class="language-solidity">function setPermissionedProver(address prover) public virtual onlyOwner;
</code></pre>
<h3 id="disablepermissionedprovermode"><a class="header" href="#disablepermissionedprovermode">disablePermissionedProverMode</a></h3>
<p>set the permissionedProver to address(0)</p>
<p>if it was already disabled, then revert with the error, NoChangeRequired</p>
<pre><code class="language-solidity">function disablePermissionedProverMode() public virtual onlyOwner;
</code></pre>
<h3 id="updatestatehistory"><a class="header" href="#updatestatehistory">updateStateHistory</a></h3>
<p>Updates the <code>stateHistoryCommitments</code> array when a new finalized state is added
and prunes the most outdated element starting from the first element if they fall outside
the
<code>stateHistoryRetentionPeriod</code>.</p>
<p>the block timestamp is used to determine if the stateHistoryCommitments array
should be pruned, based on the stateHistoryRetentionPeriod (seconds).</p>
<p>A FIFO approach is used to remove the most outdated element from the start of the
array.
However, only one outdated element is removed per invocation of this function, even if
multiple elements exceed the retention period. As a result, some outdated elements may
remain in the array temporarily until subsequent invocations of this function.</p>
<p>the <code>delete</code> method does not reduce the array length but resets the value at the
specified index to zero. the stateHistoryFirstIndex variable acts as an offset to indicate
the starting point for reading the array, since the length of the array is not reduced
even after deletion.</p>
<pre><code class="language-solidity">function updateStateHistory(
    uint64 blockNumber,
    uint64 blockTimestamp,
    LightClientState memory state
) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>blockNumber</code></td><td><code>uint64</code></td><td>The block number of the new finalized state.</td></tr>
<tr><td><code>blockTimestamp</code></td><td><code>uint64</code></td><td>The block timestamp used to check the retention period.</td></tr>
<tr><td><code>state</code></td><td><code>LightClientState</code></td><td>The new <code>LightClientState</code> being added to the array.</td></tr>
</tbody>
</table>
</div>
<h3 id="lagoverescapehatchthreshold"><a class="header" href="#lagoverescapehatchthreshold">lagOverEscapeHatchThreshold</a></h3>
<p>checks if the state updates lag behind the specified block threshold based on the
provided block number.</p>
<p>Reverts if there isn’t enough state history to make an accurate comparison.
Reverts if the blockThreshold is zero</p>
<pre><code class="language-solidity">function lagOverEscapeHatchThreshold(uint256 blockNumber, uint256 blockThreshold)
    public
    view
    virtual
    returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>blockNumber</code></td><td><code>uint256</code></td><td>The block number to compare against the latest state updates.</td></tr>
<tr><td><code>blockThreshold</code></td><td><code>uint256</code></td><td>The number of blocks updates this contract is allowed to lag behind.</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool returns true if the lag exceeds the blockThreshold; otherwise, false.</td></tr>
</tbody>
</table>
</div>
<h3 id="gethotshotcommitment"><a class="header" href="#gethotshotcommitment">getHotShotCommitment</a></h3>
<p>get the HotShot commitment that represents the Merkle root containing the leaf at
the provided hotShotBlockHeight where the block height in the array is greater than</p>
<p>if the provided hotShotBlockHeight is greater than or equal to the latest commitment in
the array,
the function reverts.</p>
<pre><code class="language-solidity">function getHotShotCommitment(uint256 hotShotBlockHeight)
    public
    view
    virtual
    returns (BN254.ScalarField hotShotBlockCommRoot, uint64 hotshotBlockHeight);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>hotShotBlockHeight</code></td><td><code>uint256</code></td><td>the HotShot block height</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>hotShotBlockCommRoot</code></td><td><code>BN254.ScalarField</code></td><td>the HotShot commitment root</td></tr>
<tr><td><code>hotshotBlockHeight</code></td><td><code>uint64</code></td><td>the HotShot block height for the corresponding commitment root</td></tr>
</tbody>
</table>
</div>
<h3 id="getstatehistorycount"><a class="header" href="#getstatehistorycount">getStateHistoryCount</a></h3>
<p>get the number of state history commitments</p>
<pre><code class="language-solidity">function getStateHistoryCount() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>uint256 The number of state history commitments</td></tr>
</tbody>
</table>
</div>
<h3 id="setstatehistoryretentionperiod"><a class="header" href="#setstatehistoryretentionperiod">setstateHistoryRetentionPeriod</a></h3>
<p>sets the maximum retention period for storing block state history.</p>
<p>Reverts with <code>InvalidMaxStateHistory</code> if the provided value is less than 1 hour,
more than 365 days or less than or equal to the current state history retention period.</p>
<pre><code class="language-solidity">function setstateHistoryRetentionPeriod(uint32 historySeconds) public onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>historySeconds</code></td><td><code>uint32</code></td><td>The maximum number of seconds for which state history updates will be stored, based on the block timestamp. It must be greater than or equal to the current state history retention period and must be at least 1 hour and max 365 days.</td></tr>
</tbody>
</table>
</div>
<h3 id="ispermissionedproverenabled"><a class="header" href="#ispermissionedproverenabled">isPermissionedProverEnabled</a></h3>
<p>Check if permissioned prover is enabled</p>
<pre><code class="language-solidity">function isPermissionedProverEnabled() public view returns (bool);
</code></pre>
<h2 id="events-2"><a class="header" href="#events-2">Events</a></h2>
<h3 id="upgrade-1"><a class="header" href="#upgrade-1">Upgrade</a></h3>
<p>upgrade event when the proxy updates the implementation it’s pointing to</p>
<pre><code class="language-solidity">event Upgrade(address implementation);
</code></pre>
<h3 id="permissionedproverrequired"><a class="header" href="#permissionedproverrequired">PermissionedProverRequired</a></h3>
<p>when a permissioned prover is set, this event is emitted.</p>
<pre><code class="language-solidity">event PermissionedProverRequired(address permissionedProver);
</code></pre>
<h3 id="permissionedprovernotrequired"><a class="header" href="#permissionedprovernotrequired">PermissionedProverNotRequired</a></h3>
<p>when the permissioned prover is unset, this event is emitted.</p>
<pre><code class="language-solidity">event PermissionedProverNotRequired();
</code></pre>
<h3 id="newstate"><a class="header" href="#newstate">NewState</a></h3>
<p>Event that a new finalized state has been successfully verified and updated</p>
<pre><code class="language-solidity">event NewState(
    uint64 indexed viewNum, uint64 indexed blockHeight, BN254.ScalarField blockCommRoot
);
</code></pre>
<h2 id="errors-11"><a class="header" href="#errors-11">Errors</a></h2>
<h3 id="outdatedstate"><a class="header" href="#outdatedstate">OutdatedState</a></h3>
<p>The state is outdated and older than currently known <code>finalizedState</code></p>
<pre><code class="language-solidity">error OutdatedState();
</code></pre>
<h3 id="invalidargs"><a class="header" href="#invalidargs">InvalidArgs</a></h3>
<p>Invalid user inputs: wrong format or non-sensible arguments</p>
<pre><code class="language-solidity">error InvalidArgs();
</code></pre>
<h3 id="invalidproof"><a class="header" href="#invalidproof">InvalidProof</a></h3>
<p>Wrong plonk proof or public inputs.</p>
<pre><code class="language-solidity">error InvalidProof();
</code></pre>
<h3 id="wrongstaketableused"><a class="header" href="#wrongstaketableused">WrongStakeTableUsed</a></h3>
<p>Wrong stake table used, should match <code>finalizedState</code></p>
<pre><code class="language-solidity">error WrongStakeTableUsed();
</code></pre>
<h3 id="invalidaddress"><a class="header" href="#invalidaddress">InvalidAddress</a></h3>
<p>Invalid address</p>
<pre><code class="language-solidity">error InvalidAddress();
</code></pre>
<h3 id="provernotpermissioned"><a class="header" href="#provernotpermissioned">ProverNotPermissioned</a></h3>
<p>Only a permissioned prover can perform this action</p>
<pre><code class="language-solidity">error ProverNotPermissioned();
</code></pre>
<h3 id="nochangerequired"><a class="header" href="#nochangerequired">NoChangeRequired</a></h3>
<p>If the same mode or prover is sent to the function, then no change is required</p>
<pre><code class="language-solidity">error NoChangeRequired();
</code></pre>
<h3 id="insufficientsnapshothistory"><a class="header" href="#insufficientsnapshothistory">InsufficientSnapshotHistory</a></h3>
<p>Invalid L1 Block for checking Light Client Updates, premature or in the future</p>
<pre><code class="language-solidity">error InsufficientSnapshotHistory();
</code></pre>
<h3 id="invalidhotshotblockforcommitmentcheck"><a class="header" href="#invalidhotshotblockforcommitmentcheck">InvalidHotShotBlockForCommitmentCheck</a></h3>
<p>Invalid HotShot Block for checking HotShot commitments, premature or in the future</p>
<pre><code class="language-solidity">error InvalidHotShotBlockForCommitmentCheck();
</code></pre>
<h3 id="invalidmaxstatehistory"><a class="header" href="#invalidmaxstatehistory">InvalidMaxStateHistory</a></h3>
<p>Invalid Max Block States</p>
<pre><code class="language-solidity">error InvalidMaxStateHistory();
</code></pre>
<h3 id="ownershipcannotberenounced-2"><a class="header" href="#ownershipcannotberenounced-2">OwnershipCannotBeRenounced</a></h3>
<p>Cannot renounce ownership</p>
<pre><code class="language-solidity">error OwnershipCannotBeRenounced();
</code></pre>
<h2 id="structs-9"><a class="header" href="#structs-9">Structs</a></h2>
<h3 id="lightclientstate"><a class="header" href="#lightclientstate">LightClientState</a></h3>
<p>The finalized HotShot state (as the digest of the entire HotShot state)</p>
<pre><code class="language-solidity">struct LightClientState {
    uint64 viewNum;
    uint64 blockHeight;
    BN254.ScalarField blockCommRoot;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>viewNum</code></td><td><code>uint64</code></td><td>The latest view number of the finalized HotShot chain</td></tr>
<tr><td><code>blockHeight</code></td><td><code>uint64</code></td><td>The block height of the latest finalized block</td></tr>
<tr><td><code>blockCommRoot</code></td><td><code>BN254.ScalarField</code></td><td>The merkle root of historical block commitments (BN254::ScalarField)</td></tr>
</tbody>
</table>
</div>
<h3 id="staketablestate"><a class="header" href="#staketablestate">StakeTableState</a></h3>
<p>The finalized HotShot Stake state (as the digest of the entire HotShot state)</p>
<pre><code class="language-solidity">struct StakeTableState {
    uint256 threshold;
    BN254.ScalarField blsKeyComm;
    BN254.ScalarField schnorrKeyComm;
    BN254.ScalarField amountComm;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>threshold</code></td><td><code>uint256</code></td><td>The (stake-weighted) quorum threshold for a QC to be considered as valid</td></tr>
<tr><td><code>blsKeyComm</code></td><td><code>BN254.ScalarField</code></td><td>The commitment to the BlsVerKey column of the stake table</td></tr>
<tr><td><code>schnorrKeyComm</code></td><td><code>BN254.ScalarField</code></td><td>The commitment to the SchnorrVerKey column of the table</td></tr>
<tr><td><code>amountComm</code></td><td><code>BN254.ScalarField</code></td><td>The commitment to the stake amount column of the stake table</td></tr>
</tbody>
</table>
</div>
<h3 id="statehistorycommitment"><a class="header" href="#statehistorycommitment">StateHistoryCommitment</a></h3>
<p>Simplified HotShot commitment struct</p>
<pre><code class="language-solidity">struct StateHistoryCommitment {
    uint64 l1BlockHeight;
    uint64 l1BlockTimestamp;
    uint64 hotShotBlockHeight;
    BN254.ScalarField hotShotBlockCommRoot;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>l1BlockHeight</code></td><td><code>uint64</code></td><td>the block height of l1 when this state update was stored</td></tr>
<tr><td><code>l1BlockTimestamp</code></td><td><code>uint64</code></td><td>the block timestamp of l1 when this state update was stored</td></tr>
<tr><td><code>hotShotBlockHeight</code></td><td><code>uint64</code></td><td>The block height of the latest finalized HotShot block</td></tr>
<tr><td><code>hotShotBlockCommRoot</code></td><td><code>BN254.ScalarField</code></td><td>The merkle root of historical block commitments (BN254::ScalarField)</td></tr>
</tbody>
</table>
</div>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="arbsys"><a class="header" href="#arbsys">ArbSys</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/LightClientArbitrum.sol">Git Source</a></p>
<h2 id="functions-22"><a class="header" href="#functions-22">Functions</a></h2>
<h3 id="arbblocknumber"><a class="header" href="#arbblocknumber">arbBlockNumber</a></h3>
<pre><code class="language-solidity">function arbBlockNumber() external view returns (uint256);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lightclientarbitrum"><a class="header" href="#lightclientarbitrum">LightClientArbitrum</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/LightClientArbitrum.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/contracts/src/LightClient.sol/contract.LightClient.html">LightClient</a></p>
<h2 id="functions-23"><a class="header" href="#functions-23">Functions</a></h2>
<h3 id="currentblocknumber-1"><a class="header" href="#currentblocknumber-1">currentBlockNumber</a></h3>
<pre><code class="language-solidity">function currentBlockNumber() public view virtual override returns (uint256);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="arbsys-1"><a class="header" href="#arbsys-1">ArbSys</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/LightClientArbitrumV2.sol">Git Source</a></p>
<h2 id="functions-24"><a class="header" href="#functions-24">Functions</a></h2>
<h3 id="arbblocknumber-1"><a class="header" href="#arbblocknumber-1">arbBlockNumber</a></h3>
<pre><code class="language-solidity">function arbBlockNumber() external view returns (uint256);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lightclientarbitrumv2"><a class="header" href="#lightclientarbitrumv2">LightClientArbitrumV2</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/LightClientArbitrumV2.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/contracts/src/LightClientV2.sol/contract.LightClientV2.html">LightClientV2</a></p>
<h2 id="functions-25"><a class="header" href="#functions-25">Functions</a></h2>
<h3 id="currentblocknumber-2"><a class="header" href="#currentblocknumber-2">currentBlockNumber</a></h3>
<pre><code class="language-solidity">function currentBlockNumber() public view virtual override returns (uint256);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="arbsys-2"><a class="header" href="#arbsys-2">ArbSys</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/LightClientArbitrumV3.sol">Git Source</a></p>
<h2 id="functions-26"><a class="header" href="#functions-26">Functions</a></h2>
<h3 id="arbblocknumber-2"><a class="header" href="#arbblocknumber-2">arbBlockNumber</a></h3>
<pre><code class="language-solidity">function arbBlockNumber() external view returns (uint256);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lightclientarbitrumv3"><a class="header" href="#lightclientarbitrumv3">LightClientArbitrumV3</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/LightClientArbitrumV3.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/contracts/src/LightClientV3.sol/contract.LightClientV3.html">LightClientV3</a></p>
<h2 id="functions-27"><a class="header" href="#functions-27">Functions</a></h2>
<h3 id="currentblocknumber-3"><a class="header" href="#currentblocknumber-3">currentBlockNumber</a></h3>
<pre><code class="language-solidity">function currentBlockNumber() public view virtual override returns (uint256);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lightclientv2"><a class="header" href="#lightclientv2">LightClientV2</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/LightClientV2.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/contracts/src/LightClient.sol/contract.LightClient.html">LightClient</a></p>
<p>LightClient V2: with stake table snapshot update during epoch change.</p>
<h2 id="state-variables-9"><a class="header" href="#state-variables-9">State Variables</a></h2>
<h3 id="blocksperepoch-1"><a class="header" href="#blocksperepoch-1">blocksPerEpoch</a></h3>
<p>number of blocks per epoch</p>
<pre><code class="language-solidity">uint64 public blocksPerEpoch
</code></pre>
<h3 id="epochstartblock"><a class="header" href="#epochstartblock">epochStartBlock</a></h3>
<p>the block height when Epoch-related logic gets activated</p>
<pre><code class="language-solidity">uint64 public epochStartBlock
</code></pre>
<h3 id="firstepoch"><a class="header" href="#firstepoch">firstEpoch</a></h3>
<p>the first epoch where dynamic stake table is activated, not the numerical value
epoch=1</p>
<pre><code class="language-solidity">uint64 private firstEpoch
</code></pre>
<h3 id="votingstaketablestate"><a class="header" href="#votingstaketablestate">votingStakeTableState</a></h3>
<p>stake table commitments for the current voting stakers</p>
<pre><code class="language-solidity">StakeTableState public votingStakeTableState
</code></pre>
<h2 id="functions-28"><a class="header" href="#functions-28">Functions</a></h2>
<h3 id="initializev2-1"><a class="header" href="#initializev2-1">initializeV2</a></h3>
<p>Initialize V2</p>
<pre><code class="language-solidity">function initializeV2(uint64 _blocksPerEpoch, uint64 _epochStartBlock)
    public
    onlyOwner
    reinitializer(2);
</code></pre>
<h3 id="getversion-4"><a class="header" href="#getversion-4">getVersion</a></h3>
<pre><code class="language-solidity">function getVersion()
    public
    pure
    virtual
    override
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<h3 id="newfinalizedstate-1"><a class="header" href="#newfinalizedstate-1">newFinalizedState</a></h3>
<p>override the V1’s to disable calling it</p>
<pre><code class="language-solidity">function newFinalizedState(LightClientState memory, IPlonkVerifier.PlonkProof memory)
    external
    pure
    override;
</code></pre>
<h3 id="setstatehistoryretentionperiod-1"><a class="header" href="#setstatehistoryretentionperiod-1">setStateHistoryRetentionPeriod</a></h3>
<p>identical as LightClientV1’s <code>setstateHistoryRetentionPeriod()</code>
but this function name has the correct camelCase</p>
<pre><code class="language-solidity">function setStateHistoryRetentionPeriod(uint32 historySeconds) public virtual onlyOwner;
</code></pre>
<h3 id="updateepochstartblock"><a class="header" href="#updateepochstartblock">updateEpochStartBlock</a></h3>
<pre><code class="language-solidity">function updateEpochStartBlock(uint64 newEpochStartBlock) public virtual onlyOwner;
</code></pre>
<h3 id="newfinalizedstate-1-1"><a class="header" href="#newfinalizedstate-1-1">newFinalizedState</a></h3>
<p>See detailed doc in <code>LightClient.sol</code></p>
<pre><code class="language-solidity">function newFinalizedState(
    LightClientState memory newState,
    StakeTableState memory nextStakeTable,
    IPlonkVerifier.PlonkProof memory proof
) external virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newState</code></td><td><code>LightClientState</code></td><td></td></tr>
<tr><td><code>nextStakeTable</code></td><td><code>StakeTableState</code></td><td>the stake table to use in the next block (same as the current except</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td></td></tr>
</tbody>
</table>
</div>
<h3 id="_getvk-1"><a class="header" href="#_getvk-1">_getVk</a></h3>
<pre><code class="language-solidity">function _getVk() public pure virtual override returns (IPlonkVerifier.VerifyingKey memory vk);
</code></pre>
<h3 id="verifyproof-1"><a class="header" href="#verifyproof-1">verifyProof</a></h3>
<p>compare to V1, we extend public input length from 7 to 11, use a newly generated VK,
and enforce correct usage of the nextStakeTable outside the epoch change period.</p>
<pre><code class="language-solidity">function verifyProof(
    LightClientState memory state,
    StakeTableState memory nextStakeTable,
    IPlonkVerifier.PlonkProof memory proof
) internal virtual;
</code></pre>
<h3 id="currentepoch"><a class="header" href="#currentepoch">currentEpoch</a></h3>
<p>Returns the current epoch according the latest update on finalizedState</p>
<pre><code class="language-solidity">function currentEpoch() public view virtual returns (uint64);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint64</code></td><td>current epoch (computed from the last known hotshot block number)</td></tr>
</tbody>
</table>
</div>
<h3 id="epochfromblocknumber"><a class="header" href="#epochfromblocknumber">epochFromBlockNumber</a></h3>
<p>Calculate the epoch number from the hotshot block number</p>
<p>same logic as <code>hotshot_types::utils::epoch_from_block_number()</code></p>
<pre><code class="language-solidity">function epochFromBlockNumber(uint64 _blockNum, uint64 _blocksPerEpoch)
    public
    pure
    virtual
    returns (uint64);
</code></pre>
<h3 id="isepochroot"><a class="header" href="#isepochroot">isEpochRoot</a></h3>
<p>Decide if a block height is the an “epoch root” (defined as last block in epoch - 5)</p>
<p>see
<a href="https://github.com/EspressoSystems/espresso-network/blob/2a904fa17838961cef130d0e87d7b371acaaea42/hotshot-types/src/utils.rs#L475">https://github.com/EspressoSystems/espresso-network/blob/2a904fa17838961cef130d0e87d7b371acaaea42/hotshot-types/src/utils.rs#L475</a></p>
<pre><code class="language-solidity">function isEpochRoot(uint64 blockHeight) public view virtual returns (bool);
</code></pre>
<h3 id="isgtepochroot"><a class="header" href="#isgtepochroot">isGtEpochRoot</a></h3>
<p>Returns true if the given block number is greater than the epoch root block</p>
<pre><code class="language-solidity">function isGtEpochRoot(uint64 blockHeight) public view virtual returns (bool);
</code></pre>
<h2 id="events-3"><a class="header" href="#events-3">Events</a></h2>
<h3 id="newepoch"><a class="header" href="#newepoch">NewEpoch</a></h3>
<p>When entering a new epoch and a new stake table snapshot.</p>
<pre><code class="language-solidity">event NewEpoch(uint64 epoch);
</code></pre>
<h2 id="errors-12"><a class="header" href="#errors-12">Errors</a></h2>
<h3 id="missingepochrootupdate"><a class="header" href="#missingepochrootupdate">MissingEpochRootUpdate</a></h3>
<p>The finalized state for the epoch root of every epoch should NOT be skipped</p>
<pre><code class="language-solidity">error MissingEpochRootUpdate();
</code></pre>
<h3 id="deprecatedapi"><a class="header" href="#deprecatedapi">DeprecatedApi</a></h3>
<p>Invocation on outdated APIs on V1</p>
<pre><code class="language-solidity">error DeprecatedApi();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="lightclientv3"><a class="header" href="#lightclientv3">LightClientV3</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/LightClientV3.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/contracts/src/LightClientV2.sol/contract.LightClientV2.html">LightClientV2</a></p>
<p><strong>Title:</strong>
LightClientV3</p>
<p>LightClientV2 with an additional root for gas-efficient state authentication and</p>
<p>improved public input derivation for efficiency and future-proof.</p>
<h2 id="state-variables-10"><a class="header" href="#state-variables-10">State Variables</a></h2>
<h3 id="authroot"><a class="header" href="#authroot">authRoot</a></h3>
<p>a state value signed by validators as part of the extended light client state</p>
<pre><code class="language-solidity">uint256 public authRoot
</code></pre>
<h3 id="_firstepoch"><a class="header" href="#_firstepoch">_firstEpoch</a></h3>
<p>Unfortunate re-declaration since V2 mark firstEpoch as private</p>
<pre><code class="language-solidity">uint64 internal _firstEpoch
</code></pre>
<h2 id="functions-29"><a class="header" href="#functions-29">Functions</a></h2>
<h3 id="initializev3"><a class="header" href="#initializev3">initializeV3</a></h3>
<pre><code class="language-solidity">function initializeV3() public onlyOwner reinitializer(3);
</code></pre>
<h3 id="getversion-5"><a class="header" href="#getversion-5">getVersion</a></h3>
<pre><code class="language-solidity">function getVersion()
    public
    pure
    virtual
    override
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<h3 id="newfinalizedstate-2"><a class="header" href="#newfinalizedstate-2">newFinalizedState</a></h3>
<p>override the V2’s to disable calling it</p>
<pre><code class="language-solidity">function newFinalizedState(
    LightClientState memory,
    StakeTableState memory,
    IPlonkVerifier.PlonkProof memory
) external pure override;
</code></pre>
<h3 id="newfinalizedstate-1-2"><a class="header" href="#newfinalizedstate-1-2">newFinalizedState</a></h3>
<p>See detailed doc in <code>LightClient.sol</code> and <code>LightClientV2.sol</code></p>
<p>more detailed inline code comments, see <code>LightClientV2.sol</code></p>
<p>diff w/ V2 is marked with “DIFF:” in comment</p>
<pre><code class="language-solidity">function newFinalizedState(
    LightClientState memory newState,
    StakeTableState memory nextStakeTable,
    uint256 newAuthRoot,
    IPlonkVerifier.PlonkProof memory proof
) external virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newState</code></td><td><code>LightClientState</code></td><td></td></tr>
<tr><td><code>nextStakeTable</code></td><td><code>StakeTableState</code></td><td></td></tr>
<tr><td><code>newAuthRoot</code></td><td><code>uint256</code></td><td>is the authentication root corresponding to newState</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td></td></tr>
</tbody>
</table>
</div>
<h3 id="_getvk-2"><a class="header" href="#_getvk-2">_getVk</a></h3>
<pre><code class="language-solidity">function _getVk() public pure virtual override returns (IPlonkVerifier.VerifyingKey memory vk);
</code></pre>
<h3 id="verifyproof-2"><a class="header" href="#verifyproof-2">verifyProof</a></h3>
<p>compare to V2, we change public input length from 11 to 5:</p>
<p>4 from votingStakeTableState, 1 from msg_signed := H(authenticated states)</p>
<pre><code class="language-solidity">function verifyProof(
    LightClientState memory state,
    StakeTableState memory nextStakeTable,
    uint256 newAuthRoot,
    IPlonkVerifier.PlonkProof memory proof
) internal virtual;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="opstimelock"><a class="header" href="#opstimelock">OpsTimelock</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/OpsTimelock.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
TimelockController</p>
<p><strong>Title:</strong>
OpsTimelock</p>
<p>A timelock controller for contracts that require faster updates</p>
<p>Timelock used for operational control during early protocol phases.
Grants privileged access to core team for upgrades or config changes
with a short delay.</p>
<h2 id="functions-30"><a class="header" href="#functions-30">Functions</a></h2>
<h3 id="constructor-6"><a class="header" href="#constructor-6">constructor</a></h3>
<pre><code class="language-solidity">constructor(
    uint256 minDelay,
    address[] memory proposers,
    address[] memory executors,
    address admin
) TimelockController(minDelay, proposers, executors, admin);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="rewardclaim-1"><a class="header" href="#rewardclaim-1">RewardClaim</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/RewardClaim.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/contracts/src/interfaces/IRewardClaim.sol/interface.IRewardClaim.html">IRewardClaim</a>, Initializable, UUPSUpgradeable, PausableUpgradeable, AccessControlUpgradeable, ReentrancyGuardUpgradeable</p>
<p><strong>Title:</strong>
RewardClaim - Espresso Reward Claim Contract</p>
<p>Allows validators and delegators to claim ESP token rewards based on cryptographic
proofs from the Espresso network.</p>
<p>Daily Limit Fairness: This contract enforces daily claim limits on a first-come,
first-served basis. Once the limit is reached, remaining claimers must wait until the next day.
In unlikely but not impossible scenarios they may be unable to claim for multiple days. The
limit (default 1%, max 5% of supply) is set high enough that it should never be reached under
normal operation. This is a simple defense-in-depth mechanism to limit potential damage in the
unlikely case an attacker is able to circumvent authentication of reward claims. It is not a
mechanism to throttle rate of withdrawals under normal operation. Stakers are encouraged to
claim their rewards periodically and take advantage of staking their rewards.</p>
<p>Governance Architecture:
This contract uses ONLY AccessControlUpgradeable.</p>
<ul>
<li>DEFAULT_ADMIN_ROLE: Can upgrade contract, manage roles, update daily limits</li>
<li>PAUSER_ROLE: Can pause/unpause user facing methods in the contract during emergencies
Governance: This contract enforces a single-admin model. <code>currentAdmin</code> and
<code>DEFAULT_ADMIN_ROLE</code> always reference the same address and can only be changed via
<code>grantRole(DEFAULT_ADMIN_ROLE, ...)</code>. Any attempt to revoke or renounce the default admin role
reverts so that there is always a single admin.</li>
</ul>
<h2 id="state-variables-11"><a class="header" href="#state-variables-11">State Variables</a></h2>
<h3 id="esptoken-1"><a class="header" href="#esptoken-1">espToken</a></h3>
<p>The ESP token contract</p>
<pre><code class="language-solidity">EspTokenV2 public espToken
</code></pre>
<h3 id="lightclient-1"><a class="header" href="#lightclient-1">lightClient</a></h3>
<p>The light client contract</p>
<pre><code class="language-solidity">LightClientV3 public lightClient
</code></pre>
<h3 id="claimedrewards-1"><a class="header" href="#claimedrewards-1">claimedRewards</a></h3>
<p>Tracks total lifetime rewards claimed by each address</p>
<pre><code class="language-solidity">mapping(address claimer =&gt; uint256 claimed) public claimedRewards
</code></pre>
<h3 id="dailylimitwei"><a class="header" href="#dailylimitwei">dailyLimitWei</a></h3>
<p>Maximum amount (in Wei) that can be claimed per day across all claimers</p>
<p>Daily limits provide defense-in-depth security: in the unlikely event an exploit for
the merkle proof verification is discovered, at most the daily limit can be minted before
the contract is paused by the PAUSER_ROLE. This offers a second layer of protection beyond
cryptographic verification.</p>
<p>This parameter is intentionally kept non-dynamic such that inflating the token
<code>totalSupply</code> will not inflate the value of this limiting parameter.</p>
<pre><code class="language-solidity">uint256 public dailyLimitWei
</code></pre>
<h3 id="lastsetdailylimitbasispoints"><a class="header" href="#lastsetdailylimitbasispoints">lastSetDailyLimitBasisPoints</a></h3>
<p>Basis points used when daily limit was last set (for reference only)</p>
<p>This is a snapshot of the basis points parameter from the last setDailyLimit call.
As total supply changes, this value becomes outdated and no longer represents the actual
percentage that dailyLimitWei represents relative to current supply.</p>
<pre><code class="language-solidity">uint256 public lastSetDailyLimitBasisPoints
</code></pre>
<h3 id="max_daily_limit_basis_points"><a class="header" href="#max_daily_limit_basis_points">MAX_DAILY_LIMIT_BASIS_POINTS</a></h3>
<p>Maximum daily limit as percentage of total supply in basis points (500 = 5%)</p>
<p>Hardcoded to prevent setting dangerously high limits without a contract upgrade.
Increasing this value further would require upgrading the contract, which is
intentional to ensure careful consideration and governance of security parameters.</p>
<pre><code class="language-solidity">uint256 public constant MAX_DAILY_LIMIT_BASIS_POINTS = 500
</code></pre>
<h3 id="bps_denominator"><a class="header" href="#bps_denominator">BPS_DENOMINATOR</a></h3>
<p>Basis points denominator (100% = 10000 bps)</p>
<pre><code class="language-solidity">uint256 public constant BPS_DENOMINATOR = 10000
</code></pre>
<h3 id="_currentday"><a class="header" href="#_currentday">_currentDay</a></h3>
<p>Current day number (days since epoch)</p>
<pre><code class="language-solidity">uint256 private _currentDay
</code></pre>
<h3 id="_claimedtoday"><a class="header" href="#_claimedtoday">_claimedToday</a></h3>
<p>Amount claimed today across all claimers</p>
<p>No view functions provided for _currentDay or _claimedToday to avoid race
conditions. Clients should use call/estimateGas on claimRewards() to check if a
claim would succeed. Honest claims should never hit rate limits under normal
operation.</p>
<p>It may be potentially useful to add a getter for when the daily limit will
reset. We don’t expect to hit the daily limits, therefore implementation in the
contract and in clients is not part of the initial release.</p>
<pre><code class="language-solidity">uint256 private _claimedToday
</code></pre>
<h3 id="pauser_role"><a class="header" href="#pauser_role">PAUSER_ROLE</a></h3>
<pre><code class="language-solidity">bytes32 public constant PAUSER_ROLE = keccak256("PAUSER_ROLE")
</code></pre>
<h3 id="currentadmin"><a class="header" href="#currentadmin">currentAdmin</a></h3>
<p>Current admin address with DEFAULT_ADMIN_ROLE</p>
<p>Tracks the single admin to enforce single-admin invariant</p>
<pre><code class="language-solidity">address public currentAdmin
</code></pre>
<h3 id="totalclaimed-1"><a class="header" href="#totalclaimed-1">totalClaimed</a></h3>
<p>Total amount of rewards claimed across all users</p>
<p>Enables convenient monitoring of unclaimed rewards by subtracting <code>totalClaimed</code>
from <code>total_reward_distributed</code> in the Espresso block header. As long as the total unclaimed
rewards is less than the daily limit, honest claims are guaranteed to never exceed the daily
limit.</p>
<pre><code class="language-solidity">uint256 public totalClaimed
</code></pre>
<h2 id="functions-31"><a class="header" href="#functions-31">Functions</a></h2>
<h3 id="constructor-7"><a class="header" href="#constructor-7">constructor</a></h3>
<pre><code class="language-solidity">constructor() ;
</code></pre>
<h3 id="initialize-3"><a class="header" href="#initialize-3">initialize</a></h3>
<p>Initializes the RewardClaim contract</p>
<p>Sets daily limit to 1% of total ESP token supply</p>
<pre><code class="language-solidity">function initialize(address _admin, address _espToken, address _lightClient, address _pauser)
    external
    virtual
    initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>_admin</code></td><td><code>address</code></td><td>Address that will be granted DEFAULT_ADMIN_ROLE for contract administration</td></tr>
<tr><td><code>_espToken</code></td><td><code>address</code></td><td>Address of the ESP token contract</td></tr>
<tr><td><code>_lightClient</code></td><td><code>address</code></td><td>Address of the light client contract</td></tr>
<tr><td><code>_pauser</code></td><td><code>address</code></td><td>Address to be granted the pauser role</td></tr>
</tbody>
</table>
</div>
<h3 id="pause"><a class="header" href="#pause">pause</a></h3>
<pre><code class="language-solidity">function pause() external virtual onlyRole(PAUSER_ROLE);
</code></pre>
<h3 id="unpause"><a class="header" href="#unpause">unpause</a></h3>
<pre><code class="language-solidity">function unpause() external virtual onlyRole(PAUSER_ROLE);
</code></pre>
<h3 id="setdailylimit"><a class="header" href="#setdailylimit">setDailyLimit</a></h3>
<p>Updates the daily limit</p>
<p>This function computes an absolute daily limit in Wei by multiplying the supplied
basis points with the current total supply of ESP tokens.</p>
<p>nonReentrant protects against reentrancy during the external call to <code>totalSupply</code>.</p>
<p>Unlikely to be exploited: we are calling our token, but the token is upgradable.</p>
<p>DO NOT REMOVE: Added for defense-in-depth.</p>
<pre><code class="language-solidity">function setDailyLimit(uint256 basisPoints)
    external
    virtual
    onlyRole(DEFAULT_ADMIN_ROLE)
    nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>basisPoints</code></td><td><code>uint256</code></td><td>Daily limit as basis points of current total supply (1-500 for 0.01%-5%)</td></tr>
</tbody>
</table>
</div>
<h3 id="claimrewards-1"><a class="header" href="#claimrewards-1">claimRewards</a></h3>
<p>Claim all unclaimed staking rewards</p>
<p>nonReentrant is not strictly necessary:</p>
<ul>
<li>claimedRewards updated before external call</li>
<li>re-entrancy would change msg.sender making proof verification fail</li>
<li>we are calling <em>our</em> token</li>
</ul>
<p>The token is upgradable, the modifier makes re-entrancy simpler to reason about.</p>
<p>DO NOT REMOVE: added for defense-in-depth and clarity.</p>
<p>See RewardClaim.Reentrancy.Unit.t.sol for regression test.</p>
<pre><code class="language-solidity">function claimRewards(uint256 lifetimeRewards, bytes calldata authData)
    external
    virtual
    whenNotPaused
    nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>lifetimeRewards</code></td><td><code>uint256</code></td><td>Total earned lifetime rewards for the user</td></tr>
<tr><td><code>authData</code></td><td><code>bytes</code></td><td>Authentication data from Espresso query service</td></tr>
</tbody>
</table>
</div>
<h3 id="getversion-6"><a class="header" href="#getversion-6">getVersion</a></h3>
<pre><code class="language-solidity">function getVersion()
    external
    pure
    virtual
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<h3 id="_enforcedailylimit"><a class="header" href="#_enforcedailylimit">_enforceDailyLimit</a></h3>
<p>See “Daily Limit Fairness” in contract docs.</p>
<pre><code class="language-solidity">function _enforceDailyLimit(uint256 amount) internal virtual;
</code></pre>
<h3 id="_authorizeupgrade-3"><a class="header" href="#_authorizeupgrade-3">_authorizeUpgrade</a></h3>
<p>only the timelock can authorize an upgrade</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation)
    internal
    virtual
    override
    onlyRole(DEFAULT_ADMIN_ROLE);
</code></pre>
<h3 id="grantrole"><a class="header" href="#grantrole">grantRole</a></h3>
<p>Override grantRole to enforce single-admin invariant for DEFAULT_ADMIN_ROLE</p>
<p>When granting DEFAULT_ADMIN_ROLE, automatically revokes it from the current admin.
This ensures only one address has DEFAULT_ADMIN_ROLE at any time, atomically.
This is intentionally not pausable for emergency governance access.</p>
<pre><code class="language-solidity">function grantRole(bytes32 role, address account) public virtual override;
</code></pre>
<h3 id="renouncerole"><a class="header" href="#renouncerole">renounceRole</a></h3>
<p>Prevent renouncing DEFAULT_ADMIN_ROLE to preserve governance control</p>
<p>Override renounceRole() to revert when attempting to renounce DEFAULT_ADMIN_ROLE,
preventing accidental or malicious admin role renunciation</p>
<p>Revokes <code>role</code> from the calling account.
Roles are often managed via {grantRole} and {revokeRole}: this function’s
purpose is to provide a mechanism for accounts to lose their privileges
if they are compromised (such as when a trusted device is misplaced).
If the calling account had been revoked <code>role</code>, emits a {RoleRevoked}
event.
Requirements:</p>
<ul>
<li>the caller must be <code>callerConfirmation</code>.
May emit a {RoleRevoked} event.</li>
</ul>
<pre><code class="language-solidity">function renounceRole(bytes32 role, address callerConfirmation) public virtual override;
</code></pre>
<h3 id="revokerole"><a class="header" href="#revokerole">revokeRole</a></h3>
<p>Prevent revoking DEFAULT_ADMIN_ROLE to preserve the single-admin invariant.</p>
<p>Revokes <code>role</code> from <code>account</code>.
If <code>account</code> had been granted <code>role</code>, emits a {RoleRevoked} event.
Requirements:</p>
<ul>
<li>the caller must have <code>role</code>’s admin role.
May emit a {RoleRevoked} event.</li>
</ul>
<pre><code class="language-solidity">function revokeRole(bytes32 role, address account) public virtual override;
</code></pre>
<h3 id="_verifyauthroot"><a class="header" href="#_verifyauthroot">_verifyAuthRoot</a></h3>
<pre><code class="language-solidity">function _verifyAuthRoot(uint256 lifetimeRewards, bytes calldata authData)
    internal
    view
    virtual
    returns (bool);
</code></pre>
<h2 id="events-4"><a class="header" href="#events-4">Events</a></h2>
<h3 id="dailylimitupdated"><a class="header" href="#dailylimitupdated">DailyLimitUpdated</a></h3>
<p>The daily limit is updated</p>
<pre><code class="language-solidity">event DailyLimitUpdated(uint256 oldLimit, uint256 newLimit);
</code></pre>
<h2 id="errors-13"><a class="header" href="#errors-13">Errors</a></h2>
<h3 id="zerodailylimit"><a class="header" href="#zerodailylimit">ZeroDailyLimit</a></h3>
<p>Attempting to set daily limit to zero</p>
<pre><code class="language-solidity">error ZeroDailyLimit();
</code></pre>
<h3 id="dailylimittoohigh"><a class="header" href="#dailylimittoohigh">DailyLimitTooHigh</a></h3>
<p>Attempting to set daily limit above the maximum allowed percentage</p>
<pre><code class="language-solidity">error DailyLimitTooHigh();
</code></pre>
<h3 id="nochangerequired-1"><a class="header" href="#nochangerequired-1">NoChangeRequired</a></h3>
<p>Attempting to set daily limit to the current value</p>
<pre><code class="language-solidity">error NoChangeRequired();
</code></pre>
<h3 id="zerototalsupply"><a class="header" href="#zerototalsupply">ZeroTotalSupply</a></h3>
<p>Total ESP token supply is zero during initialization</p>
<pre><code class="language-solidity">error ZeroTotalSupply();
</code></pre>
<h3 id="zeropauseraddress"><a class="header" href="#zeropauseraddress">ZeroPauserAddress</a></h3>
<p>Pauser address is zero during initialization</p>
<pre><code class="language-solidity">error ZeroPauserAddress();
</code></pre>
<h3 id="zeroadminaddress"><a class="header" href="#zeroadminaddress">ZeroAdminAddress</a></h3>
<p>Admin address is zero during initialization</p>
<pre><code class="language-solidity">error ZeroAdminAddress();
</code></pre>
<h3 id="zerolightclientaddress"><a class="header" href="#zerolightclientaddress">ZeroLightClientAddress</a></h3>
<p>Light client address is zero during initialization</p>
<pre><code class="language-solidity">error ZeroLightClientAddress();
</code></pre>
<h3 id="zerotokenaddress"><a class="header" href="#zerotokenaddress">ZeroTokenAddress</a></h3>
<p>ESP token address is zero during initialization</p>
<pre><code class="language-solidity">error ZeroTokenAddress();
</code></pre>
<h3 id="defaultadmincannotberenounced"><a class="header" href="#defaultadmincannotberenounced">DefaultAdminCannotBeRenounced</a></h3>
<p>Attempted to renounce DEFAULT_ADMIN_ROLE which would break governance</p>
<pre><code class="language-solidity">error DefaultAdminCannotBeRenounced();
</code></pre>
<h3 id="defaultadmincannotberevoked"><a class="header" href="#defaultadmincannotberevoked">DefaultAdminCannotBeRevoked</a></h3>
<p>Attempted to revoke DEFAULT_ADMIN_ROLE which would break governance</p>
<pre><code class="language-solidity">error DefaultAdminCannotBeRevoked();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="safeexittimelock"><a class="header" href="#safeexittimelock">SafeExitTimelock</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/SafeExitTimelock.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
TimelockController</p>
<p><strong>Title:</strong>
SafeExitTimelock</p>
<p>A timelock controller for contracts that can have a long delay before updates are
applied</p>
<p>The delay on the contract is long enough for users to exit the system if they do not agree
with the update</p>
<h2 id="functions-32"><a class="header" href="#functions-32">Functions</a></h2>
<h3 id="constructor-8"><a class="header" href="#constructor-8">constructor</a></h3>
<pre><code class="language-solidity">constructor(
    uint256 minDelay,
    address[] memory proposers,
    address[] memory executors,
    address admin
) TimelockController(minDelay, proposers, executors, admin);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="staketable"><a class="header" href="#staketable">StakeTable</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/StakeTable.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Initializable, <a href="/contracts/src/InitializedAt.sol/contract.InitializedAt.html">InitializedAt</a>, OwnableUpgradeable, UUPSUpgradeable</p>
<p><strong>Title:</strong>
Ethereum L1 component of the Espresso Global Confirmation Layer (GCL) stake table.</p>
<p>All functions are marked as virtual so that future upgrades can override them.</p>
<h2 id="state-variables-12"><a class="header" href="#state-variables-12">State Variables</a></h2>
<h3 id="lightclient-2"><a class="header" href="#lightclient-2">lightClient</a></h3>
<p>Reference to the light client contract.</p>
<p>Currently unused but will be used for slashing therefore already included in the
contract.</p>
<pre><code class="language-solidity">ILightClient public lightClient
</code></pre>
<h3 id="token"><a class="header" href="#token">token</a></h3>
<p>The staking token contract.</p>
<pre><code class="language-solidity">ERC20 public token
</code></pre>
<h3 id="validators"><a class="header" href="#validators">validators</a></h3>
<p>All validators the contract knows about.</p>
<pre><code class="language-solidity">mapping(address account =&gt; Validator validator) public validators
</code></pre>
<h3 id="blskeys"><a class="header" href="#blskeys">blsKeys</a></h3>
<p>BLS keys that have been seen by the contract</p>
<p>to simplify the reasoning about what keys and prevent some errors due to
misconfigurations of validators the contract currently marks keys as used and only allow
them to be used once. This for example prevents callers from accidentally registering the
same BLS key twice.</p>
<pre><code class="language-solidity">mapping(bytes32 blsKeyHash =&gt; bool used) public blsKeys
</code></pre>
<h3 id="validatorexits"><a class="header" href="#validatorexits">validatorExits</a></h3>
<p>Validators that have exited and the time at which delegators can claim their funds.</p>
<pre><code class="language-solidity">mapping(address validator =&gt; uint256 unlocksAt) public validatorExits
</code></pre>
<h3 id="delegations"><a class="header" href="#delegations">delegations</a></h3>
<p>Currently active delegation amounts.</p>
<pre><code class="language-solidity">mapping(address validator =&gt; mapping(address delegator =&gt; uint256 amount)) public delegations
</code></pre>
<h3 id="undelegations"><a class="header" href="#undelegations">undelegations</a></h3>
<p>Delegations held in escrow that are to be unlocked at a later time.</p>
<pre><code class="language-solidity">mapping(address validator =&gt; mapping(address delegator =&gt; Undelegation)) public undelegations
</code></pre>
<h3 id="exitescrowperiod"><a class="header" href="#exitescrowperiod">exitEscrowPeriod</a></h3>
<p>The time (seconds) the contract will hold funds after undelegations are requested.
Must allow ample time for node to exit active validator set and slashing
evidence to be submitted.</p>
<pre><code class="language-solidity">uint256 public exitEscrowPeriod
</code></pre>
<h2 id="functions-33"><a class="header" href="#functions-33">Functions</a></h2>
<h3 id="constructor-9"><a class="header" href="#constructor-9">constructor</a></h3>
<p>since the constructor initializes storage on this contract we disable it</p>
<p>storage is on the proxy contract since it calls this contract via delegatecall</p>
<p><strong>Note:</strong>
oz-upgrades-unsafe-allow: constructor</p>
<pre><code class="language-solidity">constructor() ;
</code></pre>
<h3 id="initialize-4"><a class="header" href="#initialize-4">initialize</a></h3>
<pre><code class="language-solidity">function initialize(
    address _tokenAddress,
    address _lightClientAddress,
    uint256 _exitEscrowPeriod,
    address _timelock
) public initializer;
</code></pre>
<h3 id="initializestate"><a class="header" href="#initializestate">initializeState</a></h3>
<p>Initialize the state of the contract</p>
<pre><code class="language-solidity">function initializeState(
    address _tokenAddress,
    address _lightClientAddress,
    uint256 _exitEscrowPeriod
) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>_tokenAddress</code></td><td><code>address</code></td><td>The address of the staking token</td></tr>
<tr><td><code>_lightClientAddress</code></td><td><code>address</code></td><td>The address of the light client</td></tr>
<tr><td><code>_exitEscrowPeriod</code></td><td><code>uint256</code></td><td>The exit escrow period. Set to uint64.max to disable the exit escrow period.</td></tr>
</tbody>
</table>
</div>
<h3 id="getversion-7"><a class="header" href="#getversion-7">getVersion</a></h3>
<p>Use this to get the implementation contract version</p>
<pre><code class="language-solidity">function getVersion()
    public
    pure
    virtual
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>majorVersion</code></td><td><code>uint8</code></td><td>The major version of the contract</td></tr>
<tr><td><code>minorVersion</code></td><td><code>uint8</code></td><td>The minor version of the contract</td></tr>
<tr><td><code>patchVersion</code></td><td><code>uint8</code></td><td>The patch version of the contract</td></tr>
</tbody>
</table>
</div>
<h3 id="_authorizeupgrade-4"><a class="header" href="#_authorizeupgrade-4">_authorizeUpgrade</a></h3>
<p>only the timelock can authorize an upgrade</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal virtual override onlyOwner;
</code></pre>
<h3 id="renounceownership-3"><a class="header" href="#renounceownership-3">renounceOwnership</a></h3>
<p>Prevent renouncing ownership to preserve governance control.</p>
<p>Override renounceOwnership() to revert, preventing accidental or malicious ownership
renunciation</p>
<pre><code class="language-solidity">function renounceOwnership() public virtual override onlyOwner;
</code></pre>
<h3 id="_hashblskey"><a class="header" href="#_hashblskey">_hashBlsKey</a></h3>
<p>Computes a hash value of some G2 point.</p>
<pre><code class="language-solidity">function _hashBlsKey(BN254.G2Point memory blsVK) public pure returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>blsVK</code></td><td><code>BN254.G2Point</code></td><td>BLS verification key in G2</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>keccak256(blsVK)</td></tr>
</tbody>
</table>
</div>
<h3 id="ensurevalidatoractive"><a class="header" href="#ensurevalidatoractive">ensureValidatorActive</a></h3>
<pre><code class="language-solidity">function ensureValidatorActive(address validator) internal view;
</code></pre>
<h3 id="ensurevalidatornotregistered"><a class="header" href="#ensurevalidatornotregistered">ensureValidatorNotRegistered</a></h3>
<pre><code class="language-solidity">function ensureValidatorNotRegistered(address validator) internal view;
</code></pre>
<h3 id="ensurenewkey"><a class="header" href="#ensurenewkey">ensureNewKey</a></h3>
<pre><code class="language-solidity">function ensureNewKey(BN254.G2Point memory blsVK) internal view;
</code></pre>
<h3 id="ensurenonzeroschnorrkey"><a class="header" href="#ensurenonzeroschnorrkey">ensureNonZeroSchnorrKey</a></h3>
<pre><code class="language-solidity">function ensureNonZeroSchnorrKey(EdOnBN254.EdOnBN254Point memory schnorrVK) internal pure;
</code></pre>
<h3 id="registervalidator"><a class="header" href="#registervalidator">registerValidator</a></h3>
<p>Register a validator in the stake table</p>
<p>The function will revert if</p>
<ol>
<li>the validator is already registered</li>
<li>the schnorr key is zero</li>
<li>if the bls signature verification fails (this prevents rogue public-key attacks).</li>
<li>the commission is &gt; 100%</li>
</ol>
<p>No validity check on <code>schnorrVK</code> due to gas cost of Rescue hash, UIs should perform
checks where possible and alert users.</p>
<pre><code class="language-solidity">function registerValidator(
    BN254.G2Point memory blsVK,
    EdOnBN254.EdOnBN254Point memory schnorrVK,
    BN254.G1Point memory blsSig,
    uint16 commission
) external virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>blsVK</code></td><td><code>BN254.G2Point</code></td><td>The BLS verification key</td></tr>
<tr><td><code>schnorrVK</code></td><td><code>EdOnBN254.EdOnBN254Point</code></td><td>The Schnorr verification key (as the auxiliary info)</td></tr>
<tr><td><code>blsSig</code></td><td><code>BN254.G1Point</code></td><td>The BLS signature that authenticates the ethereum account this function is called from</td></tr>
<tr><td><code>commission</code></td><td><code>uint16</code></td><td>in % with 2 decimals, from 0.00% (value 0) to 100% (value 10_000)</td></tr>
</tbody>
</table>
</div>
<h3 id="deregistervalidator"><a class="header" href="#deregistervalidator">deregisterValidator</a></h3>
<p>Deregister a validator</p>
<pre><code class="language-solidity">function deregisterValidator() public virtual;
</code></pre>
<h3 id="delegate"><a class="header" href="#delegate">delegate</a></h3>
<p>Delegate to a validator</p>
<pre><code class="language-solidity">function delegate(address validator, uint256 amount) public virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The validator to delegate to</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to delegate</td></tr>
</tbody>
</table>
</div>
<h3 id="undelegate"><a class="header" href="#undelegate">undelegate</a></h3>
<p>Undelegate from a validator</p>
<pre><code class="language-solidity">function undelegate(address validator, uint256 amount) public virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The validator to undelegate from</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to undelegate</td></tr>
</tbody>
</table>
</div>
<h3 id="claimwithdrawal"><a class="header" href="#claimwithdrawal">claimWithdrawal</a></h3>
<p>Withdraw previously delegated funds after an undelegation.</p>
<pre><code class="language-solidity">function claimWithdrawal(address validator) public virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The validator to withdraw from</td></tr>
</tbody>
</table>
</div>
<h3 id="claimvalidatorexit"><a class="header" href="#claimvalidatorexit">claimValidatorExit</a></h3>
<p>Withdraw previously delegated funds after a validator has exited</p>
<pre><code class="language-solidity">function claimValidatorExit(address validator) public virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The validator to withdraw from</td></tr>
</tbody>
</table>
</div>
<h3 id="updateconsensuskeys"><a class="header" href="#updateconsensuskeys">updateConsensusKeys</a></h3>
<p>Update the consensus keys for a validator</p>
<p>This function is used to update the consensus keys for a validator</p>
<p>This function can only be called by the validator itself when it hasn’t exited</p>
<p>The validator will need to give up either its old BLS key and/or old Schnorr key</p>
<p>The validator will need to provide a BLS signature to prove that the account owns the
new BLS key</p>
<pre><code class="language-solidity">function updateConsensusKeys(
    BN254.G2Point memory newBlsVK,
    EdOnBN254.EdOnBN254Point memory newSchnorrVK,
    BN254.G1Point memory newBlsSig
) external virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newBlsVK</code></td><td><code>BN254.G2Point</code></td><td>The new BLS verification key</td></tr>
<tr><td><code>newSchnorrVK</code></td><td><code>EdOnBN254.EdOnBN254Point</code></td><td>The new Schnorr verification key</td></tr>
<tr><td><code>newBlsSig</code></td><td><code>BN254.G1Point</code></td><td>The BLS signature that the account owns the new BLS key</td></tr>
</tbody>
</table>
</div>
<h2 id="events-5"><a class="header" href="#events-5">Events</a></h2>
<h3 id="validatorregistered"><a class="header" href="#validatorregistered">ValidatorRegistered</a></h3>
<p>A registration of a new validator.</p>
<p>Signals to the confirmation layer that a new validator is ready to receive
delegations in the stake table contract. The confirmation layer uses this event to keep
track of the validator’s keys for the stake table.</p>
<p>The commission is in % with 2 decimals, from 0.00% (value 0) to 100% (value 10_000).</p>
<p>A validator registration is only valid if the BLS and Schnorr signature are valid.
The GCL must verify this and otherwise discard the validator registration when it processes
the event. The contract cannot verify the validity of the registration event and delegators
will be able to deposit as soon as this event is emitted. In the event that a delegator
delegates to an invalid validator the delegator can withdraw the delegation again in the
same way they can withdraw other delegations.</p>
<p>UIs should do their best to prevent invalid, or duplicate registrations.</p>
<p>The verification key of the BLS keypair used for consensus signing is a
<code>BN254.G2Point</code>.</p>
<p>The verification key of the state signing schnorr keypair is an
<code>EdOnBN254.EdOnBN254Point</code>.</p>
<pre><code class="language-solidity">event ValidatorRegistered(
    address indexed account,
    BN254.G2Point blsVk,
    EdOnBN254.EdOnBN254Point schnorrVk,
    uint16 commission
);
</code></pre>
<h3 id="validatorexit"><a class="header" href="#validatorexit">ValidatorExit</a></h3>
<p>A validator initiated an exit from stake table</p>
<p>All funds delegated to this validator are marked for withdrawal. Users can no longer
delegate to this validator. Their previously delegated funds are automatically undelegated.
After <code>exitEscrowPeriod</code> elapsed, delegators can claim the funds delegated to the exited
validator via <code>claimValidatorExit</code>.</p>
<p>The GCL removes this validator and all its delegations from the active validator
set.</p>
<pre><code class="language-solidity">event ValidatorExit(address indexed validator);
</code></pre>
<h3 id="delegated"><a class="header" href="#delegated">Delegated</a></h3>
<p>A Delegator delegated funds to a validator.</p>
<p>The tokens are transferred to the stake table contract.</p>
<p>The GCL adjusts the weight for this validator and the delegators delegation
associated with it.</p>
<pre><code class="language-solidity">event Delegated(address indexed delegator, address indexed validator, uint256 amount);
</code></pre>
<h3 id="undelegated"><a class="header" href="#undelegated">Undelegated</a></h3>
<p>A delegator undelegation funds from a validator.</p>
<p>The tokens are marked to be unlocked for withdrawal.</p>
<p>The GCL needs to update the stake table and adjust the weight for this validator and
the delegators delegation associated with it.</p>
<pre><code class="language-solidity">event Undelegated(address indexed delegator, address indexed validator, uint256 amount);
</code></pre>
<h3 id="consensuskeysupdated"><a class="header" href="#consensuskeysupdated">ConsensusKeysUpdated</a></h3>
<p>A validator updates their signing keys.</p>
<p>Similarly to registration events, the correctness cannot be fully determined by the
contracts.</p>
<p>The confirmation layer needs to update the stake table with the new keys.</p>
<pre><code class="language-solidity">event ConsensusKeysUpdated(
    address indexed account, BN254.G2Point blsVK, EdOnBN254.EdOnBN254Point schnorrVK
);
</code></pre>
<h3 id="withdrawal"><a class="header" href="#withdrawal">Withdrawal</a></h3>
<p>A delegator claims unlocked funds.</p>
<p>This event is not relevant for the GCL. The events that remove stake from the stake
table are <code>Undelegated</code> and <code>ValidatorExit</code>.</p>
<pre><code class="language-solidity">event Withdrawal(address indexed account, uint256 amount);
</code></pre>
<h2 id="errors-14"><a class="header" href="#errors-14">Errors</a></h2>
<h3 id="validatoralreadyregistered"><a class="header" href="#validatoralreadyregistered">ValidatorAlreadyRegistered</a></h3>
<p>A user tries to register a validator with the same address</p>
<pre><code class="language-solidity">error ValidatorAlreadyRegistered();
</code></pre>
<h3 id="validatorinactive"><a class="header" href="#validatorinactive">ValidatorInactive</a></h3>
<pre><code class="language-solidity">error ValidatorInactive();
</code></pre>
<h3 id="validatoralreadyexited"><a class="header" href="#validatoralreadyexited">ValidatorAlreadyExited</a></h3>
<p>A validator has already exited.</p>
<pre><code class="language-solidity">error ValidatorAlreadyExited();
</code></pre>
<h3 id="validatornotexited"><a class="header" href="#validatornotexited">ValidatorNotExited</a></h3>
<p>A validator has not exited yet.</p>
<pre><code class="language-solidity">error ValidatorNotExited();
</code></pre>
<h3 id="prematurewithdrawal"><a class="header" href="#prematurewithdrawal">PrematureWithdrawal</a></h3>
<pre><code class="language-solidity">error PrematureWithdrawal();
</code></pre>
<h3 id="insufficientallowance"><a class="header" href="#insufficientallowance">InsufficientAllowance</a></h3>
<pre><code class="language-solidity">error InsufficientAllowance(uint256, uint256);
</code></pre>
<h3 id="insufficientbalance"><a class="header" href="#insufficientbalance">InsufficientBalance</a></h3>
<pre><code class="language-solidity">error InsufficientBalance(uint256);
</code></pre>
<h3 id="nothingtowithdraw"><a class="header" href="#nothingtowithdraw">NothingToWithdraw</a></h3>
<pre><code class="language-solidity">error NothingToWithdraw();
</code></pre>
<h3 id="invalidschnorrvk"><a class="header" href="#invalidschnorrvk">InvalidSchnorrVK</a></h3>
<pre><code class="language-solidity">error InvalidSchnorrVK();
</code></pre>
<h3 id="blskeyalreadyused"><a class="header" href="#blskeyalreadyused">BlsKeyAlreadyUsed</a></h3>
<p>The BLS key has been previously registered in the contract.</p>
<pre><code class="language-solidity">error BlsKeyAlreadyUsed();
</code></pre>
<h3 id="invalidcommission"><a class="header" href="#invalidcommission">InvalidCommission</a></h3>
<p>The commission value is invalid.</p>
<pre><code class="language-solidity">error InvalidCommission();
</code></pre>
<h3 id="zeroaddress"><a class="header" href="#zeroaddress">ZeroAddress</a></h3>
<p>Contract dependencies initialized with zero address.</p>
<pre><code class="language-solidity">error ZeroAddress();
</code></pre>
<h3 id="undelegationalreadyexists"><a class="header" href="#undelegationalreadyexists">UndelegationAlreadyExists</a></h3>
<p>An undelegation already exists for this validator and delegator.</p>
<pre><code class="language-solidity">error UndelegationAlreadyExists();
</code></pre>
<h3 id="zeroamount"><a class="header" href="#zeroamount">ZeroAmount</a></h3>
<p>A zero amount would lead to a no-op.</p>
<pre><code class="language-solidity">error ZeroAmount();
</code></pre>
<h3 id="ownershipcannotberenounced-3"><a class="header" href="#ownershipcannotberenounced-3">OwnershipCannotBeRenounced</a></h3>
<p>Attempted to renounce ownership which would break governance controls.</p>
<pre><code class="language-solidity">error OwnershipCannotBeRenounced();
</code></pre>
<h3 id="exitescrowperiodinvalid"><a class="header" href="#exitescrowperiodinvalid">ExitEscrowPeriodInvalid</a></h3>
<p>The exit escrow period is invalid (either too short or too long)</p>
<pre><code class="language-solidity">error ExitEscrowPeriodInvalid();
</code></pre>
<h2 id="structs-10"><a class="header" href="#structs-10">Structs</a></h2>
<h3 id="validator"><a class="header" href="#validator">Validator</a></h3>
<p>Represents an Espresso validator and tracks funds currently delegated to them.</p>
<p>The <code>delegatedAmount</code> excludes funds that are currently marked for withdrawal via
undelegation or validator exit.</p>
<pre><code class="language-solidity">struct Validator {
    uint256 delegatedAmount;
    ValidatorStatus status;
}
</code></pre>
<h3 id="undelegation"><a class="header" href="#undelegation">Undelegation</a></h3>
<p>Tracks an undelegation from a validator.</p>
<pre><code class="language-solidity">struct Undelegation {
    uint256 amount;
    uint256 unlocksAt;
}
</code></pre>
<h2 id="enums"><a class="header" href="#enums">Enums</a></h2>
<h3 id="validatorstatus"><a class="header" href="#validatorstatus">ValidatorStatus</a></h3>
<p>The status of a validator.
By default a validator is in the <code>Unknown</code> state. This means it has never registered. Upon
registration the status will become <code>Active</code> and if the validator deregisters its status
becomes <code>Exited</code>.</p>
<pre><code class="language-solidity">enum ValidatorStatus {
    Unknown,
    Active,
    Exited
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="staketablev2"><a class="header" href="#staketablev2">StakeTableV2</a></h1>
<p><a href="https://github.com/EspressoSystems/espresso-network/blob/c94dea87f5853757473775acbf5ea4a70eace891/contracts/src/StakeTableV2.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/contracts/src/StakeTable.sol/contract.StakeTable.html">StakeTable</a>, PausableUpgradeable, AccessControlUpgradeable</p>
<p><strong>Title:</strong>
Ethereum L1 component of the Espresso Global Confirmation Layer (GCL) stake table.</p>
<p>This contract is an upgrade to the original StakeTable contract. On Espresso mainnet we
will only use the V2 contract. On decaf the V2 is used to upgrade the V1 that was first deployed
with the original proof of stake release.</p>
<p>The V2 contract contains the following changes:</p>
<ol>
<li>The functions to register validators and update consensus keys are updated to require both a
BLS signature and a Schnorr signature and emit the signatures via events so that the GCL can
verify them. The new functions and events have a V2 postfix. After the upgrade components that
support registration and key updates must use the V2 functions and listen to the V2 events. The
original functions revert with a <code>DeprecatedFunction</code> error in V2.</li>
<li>The exit escrow period can be updated by the owner of the contract
within valid bounds (15 blocks to 14 days).</li>
<li>The following functions can be paused by the PAUSER_ROLE:</li>
</ol>
<ul>
<li><code>claimWithdrawal(...)</code></li>
<li><code>claimValidatorExit(...)</code></li>
<li><code>delegate(...)</code></li>
<li><code>undelegate(...)</code></li>
<li><code>deregisterValidator(...)</code></li>
<li><code>registerValidatorV2(...)</code></li>
<li><code>updateConsensusKeysV2(...)</code></li>
<li><code>updateCommission(...)</code></li>
<li><code>updateMetadataUri(...)</code>
When paused, these functions revert with a standard pausable error, <code>EnforcedPause()</code>.
Only the PAUSER_ROLE can pause/unpause the contract.
Note: <code>updateExitEscrowPeriod</code> is NOT pausable for emergency governance access.</li>
</ul>
<ol start="4">
<li>The <code>claimValidatorExit</code> function is overridden to ensure
that the validator’s delegatedAmount is updated during this method
The update is deferred until the funds are actually withdrawn.</li>
<li>The <code>deregisterValidator</code> function is overridden to ensure
that the validator’s delegatedAmount is not updated during this method as it was in v1.</li>
<li>The <code>updateExitEscrowPeriod</code> function is added to allow governance to update
the exit escrow period within valid bounds (15 blocks to 14 days).</li>
<li>The <code>pause</code> and <code>unpause</code> functions are added for emergency control.</li>
<li>The commission rate for validators can be updated with the <code>updateCommission</code> function.</li>
<li>The <code>activeStake</code> variable is added to allow governance to
track the total stake in the contract. The activeStake is the
total stake that is not awaiting exit or in exited state.</li>
<li>Unique undelegation IDs are assigned to each undelegation via an auto-incrementing counter
for better event tracking. The <code>undelegationIds</code> public mapping stores IDs alongside the base
<code>undelegations</code> mapping. Events <code>UndelegatedV2</code>, <code>WithdrawalClaimed</code>, and
<code>ValidatorExitClaimed</code>
include the undelegation ID as an indexed parameter for efficient querying and tracking.</li>
<li>Validators must provide a metadata URI during registration and can update it via
<code>updateMetadataUri</code>. The metadata URI is event-sourced only (not stored on-chain for gas
efficiency). The <code>ValidatorRegisteredV2</code> event includes the metadata URI, and a new
<code>MetadataUriUpdated</code> event is emitted when validators update their URI. Metadata URIs can be
empty and cannot exceed 2048 bytes.</li>
<li>A minimum delegation amount (<code>minDelegateAmount</code>) is enforced to prevent dust delegations
and reduce state bloat. The minimum is initialized to 1 ESP token (1 ether) in <code>initializeV2</code>
and
can be updated by governance via the <code>setMinDelegateAmount</code> function. The <code>delegate</code> function
reverts with <code>DelegateAmountTooSmall</code> if the delegation amount is below the minimum.</li>
</ol>
<p>The StakeTableV2 contract ABI is a superset of the original ABI. Consumers of the
contract can use the V2 ABI, even if they would like to maintain backwards compatibility.
Governance: This contract enforces a single-admin model. <code>owner()</code> and
<code>DEFAULT_ADMIN_ROLE</code> always reference the same address and can only be
changed via <code>transferOwnership()</code> (directly or through
<code>grantRole(DEFAULT_ADMIN_ROLE, ...)</code>, which delegates to the transfer). Any
attempt to revoke or renounce the default admin role, or to renounce
ownership, reverts. This removes governance drift.</p>
<p>All functions are marked as virtual so that future upgrades can override them.</p>
<h2 id="state-variables-13"><a class="header" href="#state-variables-13">State Variables</a></h2>
<h3 id="pauser_role-1"><a class="header" href="#pauser_role-1">PAUSER_ROLE</a></h3>
<pre><code class="language-solidity">bytes32 public constant PAUSER_ROLE = keccak256("PAUSER_ROLE")
</code></pre>
<h3 id="max_metadata_uri_length"><a class="header" href="#max_metadata_uri_length">MAX_METADATA_URI_LENGTH</a></h3>
<p>Maximum length for metadata URIs (in bytes)</p>
<pre><code class="language-solidity">uint256 public constant MAX_METADATA_URI_LENGTH = 2048
</code></pre>
<h3 id="max_commission_bps"><a class="header" href="#max_commission_bps">MAX_COMMISSION_BPS</a></h3>
<p>Maximum commission in basis points (100% = 10000 bps)</p>
<pre><code class="language-solidity">uint16 public constant MAX_COMMISSION_BPS = 10000
</code></pre>
<h3 id="min_exit_escrow_period"><a class="header" href="#min_exit_escrow_period">MIN_EXIT_ESCROW_PERIOD</a></h3>
<p>Minimum exit escrow period (2 days)</p>
<p>This is a technical minimum bound enforced by the contract. Setting the exit escrow
period
to this minimum does not guarantee safety. The actual exit escrow period must be set such
that the contract holds funds long enough until they are no longer staked in Espresso,
allowing sufficient time for validators to exit the active validator set and for slashing
evidence to be submitted. Governance should set a value appropriate for Espresso network
parameters (e.g., blocksPerEpoch, blockTime, and epoch duration) to ensure security.</p>
<pre><code class="language-solidity">uint64 public constant MIN_EXIT_ESCROW_PERIOD = 2 days
</code></pre>
<h3 id="max_exit_escrow_period"><a class="header" href="#max_exit_escrow_period">MAX_EXIT_ESCROW_PERIOD</a></h3>
<p>Maximum exit escrow period (14 days)</p>
<p>Reasonable upper bound to prevent excessive lockup periods</p>
<pre><code class="language-solidity">uint64 public constant MAX_EXIT_ESCROW_PERIOD = 14 days
</code></pre>
<h3 id="mincommissionincreaseinterval"><a class="header" href="#mincommissionincreaseinterval">minCommissionIncreaseInterval</a></h3>
<p>Minimum time interval between commission increases (in seconds)</p>
<pre><code class="language-solidity">uint256 public minCommissionIncreaseInterval
</code></pre>
<h3 id="maxcommissionincrease"><a class="header" href="#maxcommissionincrease">maxCommissionIncrease</a></h3>
<p>Maximum commission increase allowed per increase (in basis points)</p>
<pre><code class="language-solidity">uint16 public maxCommissionIncrease
</code></pre>
<h3 id="activestake"><a class="header" href="#activestake">activeStake</a></h3>
<p>Total stake in active (not marked for exit) validators in the contract</p>
<pre><code class="language-solidity">uint256 public activeStake
</code></pre>
<h3 id="mindelegateamount"><a class="header" href="#mindelegateamount">minDelegateAmount</a></h3>
<p>min delegate amount</p>
<pre><code class="language-solidity">uint256 public minDelegateAmount
</code></pre>
<h3 id="commissiontracking"><a class="header" href="#commissiontracking">commissionTracking</a></h3>
<p>Commission tracking for each validator</p>
<pre><code class="language-solidity">mapping(address validator =&gt; CommissionTracking tracking) public commissionTracking
</code></pre>
<h3 id="schnorrkeys"><a class="header" href="#schnorrkeys">schnorrKeys</a></h3>
<p>Schnorr keys that have been seen by the contract</p>
<p>ensures a bijective mapping between schnorr key and ethereum account and prevents some
errors due to
misconfigurations of validators the contract currently marks keys as used and only allow
them to be used once. This for example prevents callers from accidentally registering the
same Schnorr key twice.</p>
<pre><code class="language-solidity">mapping(bytes32 schnorrKey =&gt; bool used) public schnorrKeys
</code></pre>
<h3 id="nextundelegationid"><a class="header" href="#nextundelegationid">nextUndelegationId</a></h3>
<p>Auto-incrementing counter for unique undelegation IDs</p>
<p>Initialized to 1 in initializeV2 so that 0 can be used to identify V1 undelegations</p>
<pre><code class="language-solidity">uint64 private nextUndelegationId
</code></pre>
<h3 id="undelegationids"><a class="header" href="#undelegationids">undelegationIds</a></h3>
<p>Mapping from (validator, delegator) to undelegation ID</p>
<p>Separate from base Undelegation struct since base contract is immutable</p>
<pre><code class="language-solidity">mapping(address validator =&gt; mapping(address delegator =&gt; uint64 id)) private undelegationIds
</code></pre>
<h2 id="functions-34"><a class="header" href="#functions-34">Functions</a></h2>
<h3 id="constructor-10"><a class="header" href="#constructor-10">constructor</a></h3>
<p>Constructor</p>
<p>This function is overridden to disable initializers</p>
<pre><code class="language-solidity">constructor() ;
</code></pre>
<h3 id="initializev2-2"><a class="header" href="#initializev2-2">initializeV2</a></h3>
<p>Reinitialize the contract</p>
<p>initialCommissions must be an empty array if the contract we’re
upgrading has not been used before (e.g. on mainnet). On decaf (sepolia),
this must be called with the current commissions of pre-existing
validators read from L1 events.</p>
<p>Sets up roles and transfers ownership to admin. The deployer picks the admin
address (timelock, multisig, etc.) based on config.</p>
<pre><code class="language-solidity">function initializeV2(
    address pauser,
    address admin,
    uint256 initialActiveStake,
    InitialCommission[] calldata initialCommissions
) public onlyOwner reinitializer(2);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>pauser</code></td><td><code>address</code></td><td>The address to be granted the pauser role</td></tr>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to be granted the default admin role and ownership. This should be a timelock contract address, multisig, or another governance address.</td></tr>
<tr><td><code>initialActiveStake</code></td><td><code>uint256</code></td><td>The initial active stake in the contract</td></tr>
<tr><td><code>initialCommissions</code></td><td><code>InitialCommission[]</code></td><td>commissions of validators</td></tr>
</tbody>
</table>
</div>
<h3 id="getversion-8"><a class="header" href="#getversion-8">getVersion</a></h3>
<p>Get the version of the contract</p>
<p>This function is overridden to return the version of the contract</p>
<pre><code class="language-solidity">function getVersion()
    public
    pure
    virtual
    override
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<h3 id="pause-1"><a class="header" href="#pause-1">pause</a></h3>
<p>Pause the contract</p>
<p>This function is only callable by the PAUSER_ROLE</p>
<pre><code class="language-solidity">function pause() external onlyRole(PAUSER_ROLE);
</code></pre>
<h3 id="unpause-1"><a class="header" href="#unpause-1">unpause</a></h3>
<p>Unpause the contract</p>
<p>This function is only callable by the PAUSER_ROLE</p>
<pre><code class="language-solidity">function unpause() external onlyRole(PAUSER_ROLE);
</code></pre>
<h3 id="transferownership"><a class="header" href="#transferownership">transferOwnership</a></h3>
<p>Transfers ownership and keeps DEFAULT_ADMIN_ROLE in sync
Grants the role to new owner and revokes from old owner.
Access control is enforced by both onlyRole(DEFAULT_ADMIN_ROLE) and
super.transferOwnership() which requires onlyOwner.
This ensures that only the current admin (who holds both ownership and DEFAULT_ADMIN_ROLE)
can transfer ownership.
This is intentionally not pausable for emergency governance access.</p>
<p>Transfers ownership of the contract to a new account (<code>newOwner</code>).
Can only be called by the current owner.</p>
<pre><code class="language-solidity">function transferOwnership(address newOwner)
    public
    virtual
    override
    onlyRole(DEFAULT_ADMIN_ROLE);
</code></pre>
<h3 id="grantrole-1"><a class="header" href="#grantrole-1">grantRole</a></h3>
<p>Grants a role. Granting DEFAULT_ADMIN_ROLE transfers ownership first,
which handles both role grant and ownership transfer atomically.
This is intentionally not pausable for emergency governance access.</p>
<p>Grants <code>role</code> to <code>account</code>.
If <code>account</code> had not been already granted <code>role</code>, emits a {RoleGranted}
event.
Requirements:</p>
<ul>
<li>the caller must have <code>role</code>’s admin role.
May emit a {RoleGranted} event.</li>
</ul>
<pre><code class="language-solidity">function grantRole(bytes32 role, address account) public virtual override;
</code></pre>
<h3 id="revokerole-1"><a class="header" href="#revokerole-1">revokeRole</a></h3>
<p>Prevent revoking DEFAULT_ADMIN_ROLE to preserve the single-admin invariant.</p>
<p>Revokes <code>role</code> from <code>account</code>.
If <code>account</code> had been granted <code>role</code>, emits a {RoleRevoked} event.
Requirements:</p>
<ul>
<li>the caller must have <code>role</code>’s admin role.
May emit a {RoleRevoked} event.</li>
</ul>
<pre><code class="language-solidity">function revokeRole(bytes32 role, address account) public virtual override;
</code></pre>
<h3 id="renouncerole-1"><a class="header" href="#renouncerole-1">renounceRole</a></h3>
<p>Prevent renouncing DEFAULT_ADMIN_ROLE to preserve the single-admin invariant.</p>
<p>Revokes <code>role</code> from the calling account.
Roles are often managed via {grantRole} and {revokeRole}: this function’s
purpose is to provide a mechanism for accounts to lose their privileges
if they are compromised (such as when a trusted device is misplaced).
If the calling account had been revoked <code>role</code>, emits a {RoleRevoked}
event.
Requirements:</p>
<ul>
<li>the caller must be <code>callerConfirmation</code>.
May emit a {RoleRevoked} event.</li>
</ul>
<pre><code class="language-solidity">function renounceRole(bytes32 role, address callerConfirmation) public virtual override;
</code></pre>
<h3 id="claimvalidatorexit-1"><a class="header" href="#claimvalidatorexit-1">claimValidatorExit</a></h3>
<p>Withdraw previously delegated funds after a validator has exited</p>
<p>This function is overridden to deduct the amount from the validator’s delegatedAmount</p>
<p>and to add pausable functionality</p>
<p>since the delegated Amount is no longer updated during validator exit</p>
<pre><code class="language-solidity">function claimValidatorExit(address validator) public virtual override whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The validator to withdraw from</td></tr>
</tbody>
</table>
</div>
<h3 id="claimwithdrawal-1"><a class="header" href="#claimwithdrawal-1">claimWithdrawal</a></h3>
<p>Withdraw previously delegated funds after an undelegation</p>
<p>This function is overridden to add pausable functionality and emit ID in event</p>
<pre><code class="language-solidity">function claimWithdrawal(address validator) public virtual override whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The validator to withdraw from</td></tr>
</tbody>
</table>
</div>
<h3 id="delegate-1"><a class="header" href="#delegate-1">delegate</a></h3>
<p>Delegate funds to a validator</p>
<p>This function is overridden to add pausable functionality</p>
<p>The function body is copied from V1 to maintain checks-effects-interactions pattern.</p>
<pre><code class="language-solidity">function delegate(address validator, uint256 amount) public virtual override whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The validator to delegate to</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to delegate</td></tr>
</tbody>
</table>
</div>
<h3 id="undelegate-1"><a class="header" href="#undelegate-1">undelegate</a></h3>
<p>Undelegate funds from a validator</p>
<p>This function is overridden to add pausable functionality and emit UndelegatedV2</p>
<p>The undelegation ID can be retrieved from the UndelegatedV2 event or via
getUndelegation()</p>
<pre><code class="language-solidity">function undelegate(address validator, uint256 amount) public virtual override whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The validator to undelegate from</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to undelegate</td></tr>
</tbody>
</table>
</div>
<h3 id="deregistervalidator-1"><a class="header" href="#deregistervalidator-1">deregisterValidator</a></h3>
<p>Deregister a validator</p>
<p>This function is overridden to add pausable functionality</p>
<p>and to ensure that the validator’s delegatedAmount is not updated until withdrawal</p>
<p>delegatedAmount represents the no. of tokens that have been delegated to a validator,
even if it’s not participating in consensus</p>
<p>emits ValidatorExitV2 instead of ValidatorExit</p>
<pre><code class="language-solidity">function deregisterValidator() public virtual override whenNotPaused;
</code></pre>
<h3 id="registervalidatorv2"><a class="header" href="#registervalidatorv2">registerValidatorV2</a></h3>
<p>Register a validator in the stake table</p>
<p>This function is overridden to add pausable functionality</p>
<p>and to add schnorrSig validation</p>
<pre><code class="language-solidity">function registerValidatorV2(
    BN254.G2Point memory blsVK,
    EdOnBN254.EdOnBN254Point memory schnorrVK,
    BN254.G1Point memory blsSig,
    bytes memory schnorrSig,
    uint16 commission,
    string memory metadataUri
) external virtual whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>blsVK</code></td><td><code>BN254.G2Point</code></td><td>The BLS verification key</td></tr>
<tr><td><code>schnorrVK</code></td><td><code>EdOnBN254.EdOnBN254Point</code></td><td>The Schnorr verification key</td></tr>
<tr><td><code>blsSig</code></td><td><code>BN254.G1Point</code></td><td>The BLS signature that authenticates the BLS VK</td></tr>
<tr><td><code>schnorrSig</code></td><td><code>bytes</code></td><td>The Schnorr signature that authenticates the Schnorr VK</td></tr>
<tr><td><code>commission</code></td><td><code>uint16</code></td><td>in % with 2 decimals, from 0.00% (value 0) to 100% (value 10_000)</td></tr>
<tr><td><code>metadataUri</code></td><td><code>string</code></td><td>The metadata URI for the validator</td></tr>
</tbody>
</table>
</div>
<h3 id="updateconsensuskeysv2"><a class="header" href="#updateconsensuskeysv2">updateConsensusKeysV2</a></h3>
<p>Update the consensus keys of a validator</p>
<p>This function is overridden to add pausable functionality</p>
<p>and to add schnorrSig validation</p>
<pre><code class="language-solidity">function updateConsensusKeysV2(
    BN254.G2Point memory blsVK,
    EdOnBN254.EdOnBN254Point memory schnorrVK,
    BN254.G1Point memory blsSig,
    bytes memory schnorrSig
) public virtual whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>blsVK</code></td><td><code>BN254.G2Point</code></td><td>The new BLS verification key</td></tr>
<tr><td><code>schnorrVK</code></td><td><code>EdOnBN254.EdOnBN254Point</code></td><td>The new Schnorr verification key</td></tr>
<tr><td><code>blsSig</code></td><td><code>BN254.G1Point</code></td><td>The BLS signature that authenticates the blsVK</td></tr>
<tr><td><code>schnorrSig</code></td><td><code>bytes</code></td><td>The Schnorr signature that authenticates the schnorrVK</td></tr>
</tbody>
</table>
</div>
<h3 id="updatecommission"><a class="header" href="#updatecommission">updateCommission</a></h3>
<p>Update the commission rate for a validator</p>
<ol>
<li>Only one commission <em>increase</em> per minCommissionIncreaseInterval is allowed.</li>
<li>The commission increase cannot exceed maxCommissionIncrease.
These limits protect stakers from sudden large commission increases,
particularly by exiting validators.</li>
</ol>
<pre><code class="language-solidity">function updateCommission(uint16 newCommission) external virtual whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newCommission</code></td><td><code>uint16</code></td><td>The new commission rate in % with 2 decimals (0 to 10_000)</td></tr>
</tbody>
</table>
</div>
<h3 id="updatemetadatauri"><a class="header" href="#updatemetadatauri">updateMetadataUri</a></h3>
<p>Update the metadata URI for a validator</p>
<p>The metadata URI is NOT stored on-chain. Off-chain indexers must listen to the
MetadataUriUpdated event to track the current URI. URIs should be kept reasonably short for
gas efficiency (max 2048 bytes). Only the validator (msg.sender) can update their own
metadata URI.</p>
<p>No format validation is performed on the URI - any string within length limits
(including empty string) is accepted. Consumers should validate URI format and accessibility
off-chain.</p>
<pre><code class="language-solidity">function updateMetadataUri(string memory metadataUri) external virtual whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>metadataUri</code></td><td><code>string</code></td><td>The new metadata URI</td></tr>
</tbody>
</table>
</div>
<h3 id="setmincommissionupdateinterval"><a class="header" href="#setmincommissionupdateinterval">setMinCommissionUpdateInterval</a></h3>
<p>Set the minimum interval between commission updates</p>
<pre><code class="language-solidity">function setMinCommissionUpdateInterval(uint256 newInterval)
    external
    virtual
    onlyRole(DEFAULT_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newInterval</code></td><td><code>uint256</code></td><td>The new minimum interval in seconds</td></tr>
</tbody>
</table>
</div>
<h3 id="setmaxcommissionincrease"><a class="header" href="#setmaxcommissionincrease">setMaxCommissionIncrease</a></h3>
<p>Set the maximum commission increase allowed per update</p>
<pre><code class="language-solidity">function setMaxCommissionIncrease(uint16 newMaxIncrease)
    external
    virtual
    onlyRole(DEFAULT_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newMaxIncrease</code></td><td><code>uint16</code></td><td>The new maximum increase in basis points (e.g., 500 = 5%)</td></tr>
</tbody>
</table>
</div>
<h3 id="_initializecommissions"><a class="header" href="#_initializecommissions">_initializeCommissions</a></h3>
<p>Initialize validator commissions during V2 migration</p>
<p>This function is used to retroactively initialize commission storage for validators
that were registered before the V2 upgrade. On decaf, this will be called with current
commission values read from L1 events. On mainnet, this will be called with an empty array
since there are no pre-existing validators.</p>
<pre><code class="language-solidity">function _initializeCommissions(InitialCommission[] calldata initialCommissions) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>initialCommissions</code></td><td><code>InitialCommission[]</code></td><td>Array of InitialCommission structs containing validator addresses and their commissions</td></tr>
</tbody>
</table>
</div>
<h3 id="_initializeactivestake"><a class="header" href="#_initializeactivestake">_initializeActiveStake</a></h3>
<p>Initialize the active stake in the contract</p>
<pre><code class="language-solidity">function _initializeActiveStake(uint256 initialActiveStake) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>initialActiveStake</code></td><td><code>uint256</code></td><td>The initial active stake in the contract</td></tr>
</tbody>
</table>
</div>
<h3 id="validatemetadatauri"><a class="header" href="#validatemetadatauri">validateMetadataUri</a></h3>
<p>Validate metadata URI length</p>
<p>Public view function to allow external validation before transaction submission</p>
<pre><code class="language-solidity">function validateMetadataUri(string memory metadataUri) public pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>metadataUri</code></td><td><code>string</code></td><td>The metadata URI to validate</td></tr>
</tbody>
</table>
</div>
<h3 id="updateexitescrowperiod"><a class="header" href="#updateexitescrowperiod">updateExitEscrowPeriod</a></h3>
<p>Update the exit escrow period</p>
<p>This function ensures that the exit escrow period is within the valid range
(MIN_EXIT_ESCROW_PERIOD
to MAX_EXIT_ESCROW_PERIOD). However, governance MUST set a value that ensures funds are held
until they are no longer staked in Espresso, accounting for validator exit time and slashing
evidence submission windows. This function is not pausable so that governance can perform
emergency updates in the
presence of system upgrades.</p>
<pre><code class="language-solidity">function updateExitEscrowPeriod(uint64 newExitEscrowPeriod)
    external
    virtual
    onlyRole(DEFAULT_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newExitEscrowPeriod</code></td><td><code>uint64</code></td><td>The new exit escrow period</td></tr>
</tbody>
</table>
</div>
<h3 id="getundelegation"><a class="header" href="#getundelegation">getUndelegation</a></h3>
<p>Get details of an undelegation for a (validator, delegator) pair</p>
<pre><code class="language-solidity">function getUndelegation(address validator, address delegator)
    external
    view
    returns (uint64 id, uint256 amount, uint256 unlocksAt);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>Address of the validator</td></tr>
<tr><td><code>delegator</code></td><td><code>address</code></td><td>Address of the delegator</td></tr>
</tbody>
</table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>id</code></td><td><code>uint64</code></td><td>Unique ID of the undelegation</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>Amount of tokens undelegated</td></tr>
<tr><td><code>unlocksAt</code></td><td><code>uint256</code></td><td>Timestamp when tokens can be claimed</td></tr>
</tbody>
</table>
</div>
<h3 id="_hashschnorrkey"><a class="header" href="#_hashschnorrkey">_hashSchnorrKey</a></h3>
<pre><code class="language-solidity">function _hashSchnorrKey(EdOnBN254.EdOnBN254Point memory schnorrVK)
    internal
    pure
    returns (bytes32);
</code></pre>
<h3 id="ensurenewkeys"><a class="header" href="#ensurenewkeys">ensureNewKeys</a></h3>
<p>Ensure that the BLS and Schnorr keys are not already used</p>
<pre><code class="language-solidity">function ensureNewKeys(BN254.G2Point memory blsVK, EdOnBN254.EdOnBN254Point memory schnorrVK)
    internal
    view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>blsVK</code></td><td><code>BN254.G2Point</code></td><td>The BLS verification key</td></tr>
<tr><td><code>schnorrVK</code></td><td><code>EdOnBN254.EdOnBN254Point</code></td><td>The Schnorr verification key</td></tr>
</tbody>
</table>
</div>
<h3 id="registervalidator-1"><a class="header" href="#registervalidator-1">registerValidator</a></h3>
<p>Deprecate previous registration function</p>
<p>This function is overridden to revert with a DeprecatedFunction error</p>
<p>users must call registerValidatorV2 instead</p>
<pre><code class="language-solidity">function registerValidator(
    BN254.G2Point memory,
    EdOnBN254.EdOnBN254Point memory,
    BN254.G1Point memory,
    uint16
) external pure override;
</code></pre>
<h3 id="updateconsensuskeys-1"><a class="header" href="#updateconsensuskeys-1">updateConsensusKeys</a></h3>
<p>Deprecate previous updateConsensusKeys function</p>
<p>This function is overridden to revert with a DeprecatedFunction error</p>
<p>users must call updateConsensusKeysV2 instead</p>
<pre><code class="language-solidity">function updateConsensusKeys(
    BN254.G2Point memory,
    EdOnBN254.EdOnBN254Point memory,
    BN254.G1Point memory
) external pure override;
</code></pre>
<h3 id="setmindelegateamount"><a class="header" href="#setmindelegateamount">setMinDelegateAmount</a></h3>
<p>Set the minimum delegate amount</p>
<pre><code class="language-solidity">function setMinDelegateAmount(uint256 newMinDelegateAmount)
    external
    virtual
    onlyRole(DEFAULT_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newMinDelegateAmount</code></td><td><code>uint256</code></td><td>The new minimum delegate amount in wei</td></tr>
</tbody>
</table>
</div>
<h3 id="_authorizeupgrade-5"><a class="header" href="#_authorizeupgrade-5">_authorizeUpgrade</a></h3>
<p>Authorize an upgrade to a new implementation</p>
<p>This function is overridden to use AccessControl instead of Ownable
Only addresses with DEFAULT_ADMIN_ROLE can authorize upgrades</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation)
    internal
    virtual
    override
    onlyRole(DEFAULT_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newImplementation</code></td><td><code>address</code></td><td>The address of the new implementation</td></tr>
</tbody>
</table>
</div>
<h2 id="events-6"><a class="header" href="#events-6">Events</a></h2>
<h3 id="validatorregisteredv2"><a class="header" href="#validatorregisteredv2">ValidatorRegisteredV2</a></h3>
<p>A validator is registered in the stake table</p>
<p>the blsSig and schnorrSig are validated by the Espresso Network</p>
<pre><code class="language-solidity">event ValidatorRegisteredV2(
    address indexed account,
    BN254.G2Point blsVK,
    EdOnBN254.EdOnBN254Point schnorrVK,
    uint16 commission,
    BN254.G1Point blsSig,
    bytes schnorrSig,
    string metadataUri
);
</code></pre>
<h3 id="consensuskeysupdatedv2"><a class="header" href="#consensuskeysupdatedv2">ConsensusKeysUpdatedV2</a></h3>
<p>A validator updates their consensus keys</p>
<p>the blsSig and schnorrSig are validated by the Espresso Network</p>
<pre><code class="language-solidity">event ConsensusKeysUpdatedV2(
    address indexed account,
    BN254.G2Point blsVK,
    EdOnBN254.EdOnBN254Point schnorrVK,
    BN254.G1Point blsSig,
    bytes schnorrSig
);
</code></pre>
<h3 id="exitescrowperiodupdated"><a class="header" href="#exitescrowperiodupdated">ExitEscrowPeriodUpdated</a></h3>
<p>The exit escrow period is updated</p>
<pre><code class="language-solidity">event ExitEscrowPeriodUpdated(uint64 newExitEscrowPeriod);
</code></pre>
<h3 id="commissionupdated"><a class="header" href="#commissionupdated">CommissionUpdated</a></h3>
<p>A validator updates their commission rate</p>
<p>the timestamp is emitted to simplify processing in the GCL</p>
<pre><code class="language-solidity">event CommissionUpdated(
    address indexed validator, uint256 timestamp, uint16 oldCommission, uint16 newCommission
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The address of the validator</td></tr>
<tr><td><code>timestamp</code></td><td><code>uint256</code></td><td>The timestamp of the update</td></tr>
<tr><td><code>oldCommission</code></td><td><code>uint16</code></td><td></td></tr>
<tr><td><code>newCommission</code></td><td><code>uint16</code></td><td>The new commission rate</td></tr>
</tbody>
</table>
</div>
<h3 id="mincommissionupdateintervalupdated"><a class="header" href="#mincommissionupdateintervalupdated">MinCommissionUpdateIntervalUpdated</a></h3>
<p>The minimum commission update interval is updated</p>
<pre><code class="language-solidity">event MinCommissionUpdateIntervalUpdated(uint256 newInterval);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newInterval</code></td><td><code>uint256</code></td><td>The new minimum update interval in seconds</td></tr>
</tbody>
</table>
</div>
<h3 id="maxcommissionincreaseupdated"><a class="header" href="#maxcommissionincreaseupdated">MaxCommissionIncreaseUpdated</a></h3>
<p>The maximum commission increase is updated</p>
<pre><code class="language-solidity">event MaxCommissionIncreaseUpdated(uint16 newMaxIncrease);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newMaxIncrease</code></td><td><code>uint16</code></td><td>The new maximum commission increase in basis points</td></tr>
</tbody>
</table>
</div>
<h3 id="undelegatedv2"><a class="header" href="#undelegatedv2">UndelegatedV2</a></h3>
<p>A delegator undelegated funds from a validator (V2 with unlocksAt and
undelegationId)</p>
<pre><code class="language-solidity">event UndelegatedV2(
    address indexed delegator,
    address indexed validator,
    uint64 indexed undelegationId,
    uint256 amount,
    uint256 unlocksAt
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>delegator</code></td><td><code>address</code></td><td>The address of the delegator</td></tr>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The address of the validator</td></tr>
<tr><td><code>undelegationId</code></td><td><code>uint64</code></td><td>Unique identifier for this undelegation</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount undelegated</td></tr>
<tr><td><code>unlocksAt</code></td><td><code>uint256</code></td><td>The timestamp when the funds can be claimed</td></tr>
</tbody>
</table>
</div>
<h3 id="withdrawalclaimed"><a class="header" href="#withdrawalclaimed">WithdrawalClaimed</a></h3>
<p>A delegator claimed an undelegation (V2 with undelegationId)</p>
<pre><code class="language-solidity">event WithdrawalClaimed(
    address indexed delegator,
    address indexed validator,
    uint64 indexed undelegationId,
    uint256 amount
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>delegator</code></td><td><code>address</code></td><td>The address of the delegator</td></tr>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The address of the validator</td></tr>
<tr><td><code>undelegationId</code></td><td><code>uint64</code></td><td>Unique identifier for this undelegation</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount claimed</td></tr>
</tbody>
</table>
</div>
<h3 id="validatorexitclaimed"><a class="header" href="#validatorexitclaimed">ValidatorExitClaimed</a></h3>
<p>A delegator claimed funds after validator exit</p>
<pre><code class="language-solidity">event ValidatorExitClaimed(
    address indexed delegator, address indexed validator, uint256 amount
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>delegator</code></td><td><code>address</code></td><td>The address of the delegator</td></tr>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The address of the validator</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount claimed</td></tr>
</tbody>
</table>
</div>
<h3 id="validatorexitv2"><a class="header" href="#validatorexitv2">ValidatorExitV2</a></h3>
<p>A validator initiated an exit (V2 with unlocksAt)</p>
<pre><code class="language-solidity">event ValidatorExitV2(address indexed validator, uint256 unlocksAt);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The address of the validator</td></tr>
<tr><td><code>unlocksAt</code></td><td><code>uint256</code></td><td>The timestamp when delegators can claim their funds</td></tr>
</tbody>
</table>
</div>
<h3 id="metadatauriupdated"><a class="header" href="#metadatauriupdated">MetadataUriUpdated</a></h3>
<p>A validator updated their metadata URI</p>
<pre><code class="language-solidity">event MetadataUriUpdated(address indexed validator, string metadataUri);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>validator</code></td><td><code>address</code></td><td>The address of the validator</td></tr>
<tr><td><code>metadataUri</code></td><td><code>string</code></td><td>The new metadata URI</td></tr>
</tbody>
</table>
</div>
<h3 id="mindelegateamountupdated"><a class="header" href="#mindelegateamountupdated">MinDelegateAmountUpdated</a></h3>
<p>The minimum delegate amount is updated</p>
<pre><code class="language-solidity">event MinDelegateAmountUpdated(uint256 newMinDelegateAmount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>newMinDelegateAmount</code></td><td><code>uint256</code></td><td>The new minimum delegate amount in wei</td></tr>
</tbody>
</table>
</div>
<h2 id="errors-15"><a class="header" href="#errors-15">Errors</a></h2>
<h3 id="invalidschnorrsig"><a class="header" href="#invalidschnorrsig">InvalidSchnorrSig</a></h3>
<p>The Schnorr signature is invalid (either the wrong length or the wrong key)</p>
<pre><code class="language-solidity">error InvalidSchnorrSig();
</code></pre>
<h3 id="deprecatedfunction"><a class="header" href="#deprecatedfunction">DeprecatedFunction</a></h3>
<p>The function is deprecated as it was replaced by a new function</p>
<pre><code class="language-solidity">error DeprecatedFunction();
</code></pre>
<h3 id="commissionupdatetoosoon"><a class="header" href="#commissionupdatetoosoon">CommissionUpdateTooSoon</a></h3>
<p>The commission update is too soon after the last update</p>
<pre><code class="language-solidity">error CommissionUpdateTooSoon();
</code></pre>
<h3 id="commissionincreaseexceedsmax"><a class="header" href="#commissionincreaseexceedsmax">CommissionIncreaseExceedsMax</a></h3>
<p>The commission increase exceeds the maximum allowed increase</p>
<pre><code class="language-solidity">error CommissionIncreaseExceedsMax();
</code></pre>
<h3 id="commissionunchanged"><a class="header" href="#commissionunchanged">CommissionUnchanged</a></h3>
<p>The commission value is unchanged</p>
<pre><code class="language-solidity">error CommissionUnchanged();
</code></pre>
<h3 id="invalidratelimitparameters"><a class="header" href="#invalidratelimitparameters">InvalidRateLimitParameters</a></h3>
<p>The rate limit parameters are invalid</p>
<pre><code class="language-solidity">error InvalidRateLimitParameters();
</code></pre>
<h3 id="commissionalreadyinitialized"><a class="header" href="#commissionalreadyinitialized">CommissionAlreadyInitialized</a></h3>
<p>The validator commission has already been initialized</p>
<pre><code class="language-solidity">error CommissionAlreadyInitialized(address validator);
</code></pre>
<h3 id="initialactivestakeexceedsbalance"><a class="header" href="#initialactivestakeexceedsbalance">InitialActiveStakeExceedsBalance</a></h3>
<p>The initial active stake exceeds the balance of the contract</p>
<pre><code class="language-solidity">error InitialActiveStakeExceedsBalance();
</code></pre>
<h3 id="schnorrkeyalreadyused"><a class="header" href="#schnorrkeyalreadyused">SchnorrKeyAlreadyUsed</a></h3>
<p>The Schnorr key has been previously registered in the contract.</p>
<pre><code class="language-solidity">error SchnorrKeyAlreadyUsed();
</code></pre>
<h3 id="defaultadmincannotberevoked-1"><a class="header" href="#defaultadmincannotberevoked-1">DefaultAdminCannotBeRevoked</a></h3>
<p>Attempted to revoke DEFAULT_ADMIN_ROLE which would break single-admin governance</p>
<pre><code class="language-solidity">error DefaultAdminCannotBeRevoked();
</code></pre>
<h3 id="defaultadmincannotberenounced-1"><a class="header" href="#defaultadmincannotberenounced-1">DefaultAdminCannotBeRenounced</a></h3>
<p>Attempted to renounce DEFAULT_ADMIN_ROLE which would break single-admin governance</p>
<pre><code class="language-solidity">error DefaultAdminCannotBeRenounced();
</code></pre>
<h3 id="noundelegationfound"><a class="header" href="#noundelegationfound">NoUndelegationFound</a></h3>
<p>No undelegation exists for the given validator and delegator</p>
<pre><code class="language-solidity">error NoUndelegationFound();
</code></pre>
<h3 id="invalidmetadataurilength"><a class="header" href="#invalidmetadataurilength">InvalidMetadataUriLength</a></h3>
<p>The metadata URI exceeds maximum allowed length</p>
<pre><code class="language-solidity">error InvalidMetadataUriLength();
</code></pre>
<h3 id="delegateamounttoosmall"><a class="header" href="#delegateamounttoosmall">DelegateAmountTooSmall</a></h3>
<p>The delegate amount is too small</p>
<pre><code class="language-solidity">error DelegateAmountTooSmall();
</code></pre>
<h3 id="mindelegateamounttoosmall"><a class="header" href="#mindelegateamounttoosmall">MinDelegateAmountTooSmall</a></h3>
<p>The minimum delegate amount is too small</p>
<pre><code class="language-solidity">error MinDelegateAmountTooSmall();
</code></pre>
<h2 id="structs-11"><a class="header" href="#structs-11">Structs</a></h2>
<h3 id="commissiontracking-1"><a class="header" href="#commissiontracking-1">CommissionTracking</a></h3>
<p>Struct for tracking validator commission and last increase time</p>
<pre><code class="language-solidity">struct CommissionTracking {
    uint16 commission;
    uint256 lastIncreaseTime;
}
</code></pre>
<h3 id="initialcommission"><a class="header" href="#initialcommission">InitialCommission</a></h3>
<p>Struct for initializing validator commissions during migration</p>
<pre><code class="language-solidity">struct InitialCommission {
    address validator;
    uint16 commission;
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity-8ef9a95c.min.js"></script>

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>


    </div>
    </body>
</html>
